if (self.CavalryLogger) { CavalryLogger.start_js(["q1Egz"]); }

__d("ChatNotificationConstants",[],(function a(b,c,d,e,f,g){f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};}),null);
__d("MercuryActionStatus",[],(function a(b,c,d,e,f,g){f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};}),null);
__d("MercuryActionType",[],(function a(b,c,d,e,f,g){f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",ADD_GROUP_ADMINS:"ma-type:add_group_admins",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",CHANGE_FLAG:"ma-type:change_flag",UPDATE_PRIORITY:"ma-type:update_priority",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message",JOINABLE_MODE:"ma-type:joinable-mode",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue",IS_PIN_PROTECTED:"ma-type:is_pin_protected",REACTION_UPDATE:"ma-type:reaction-update",UPDATE_RTC_CALL_DATA:"ma-type:update-rtc-call-data"};}),null);
__d("MercuryAPIArgsSource",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};}),null);
__d("MercuryAttachmentContentType",[],(function a(b,c,d,e,f,g){f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};}),null);
__d("MercuryAudioType",[],(function a(b,c,d,e,f,g){f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};}),null);
__d("MercuryErrorType",[],(function a(b,c,d,e,f,g){f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};}),null);
__d("MercuryGlobalActionType",[],(function a(b,c,d,e,f,g){f.exports={MARK_ALL_READ:"mga-type:mark-all-read"};}),null);
__d("MercuryLogMessageType",[],(function a(b,c,d,e,f,g){f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};}),null);
__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};}),null);
__d("MercuryPayloadSource",[],(function a(b,c,d,e,f,g){f.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CHANGE_CUSTOM_LIKE:"client_change_custom_like",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",CLIENT_UNWRAP_MESSAGE:"client_unwrap_message",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_UNSEEN_THREADS:"server_unseen_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag",SERVER_INVALIDATE_THREAD_STATE:"server_invalidate_thread_state",SERVER_INVALIDATE_GLOBAL_STATE:"server_invalidate_global_state"};}),null);
__d("MercurySendMessageFields",[],(function a(b,c,d,e,f,g){f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};}),null);
__d("MercurySourceType",[],(function a(b,c,d,e,f,g){f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",CONTACT_ADD_MUTATION:"source:contact_add:graphql_mutation",CONTACT_ADD_CYMK:"source:contact_add:cymk_suggestion",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",EVENT_REMINDERS:"source:event_reminders",FUNDRAISER_MESSAGE_BLAST:"source:fundraiser_message_blast",GENERIC_ADMIN_TEXT:"source:generic_admin_text",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",INVITE:"source:invite",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",MESSENGER_OMNIM:"source:messenger:omnim",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",MARKETPLACE:"source:marketplace",MESSENGER_LEAD_GEN:"source:messenger:lead_gen",PAGES_MESSAGE_SHORTLINK:"source:pages:message_shortlink",STICKER_SUBSCRIBE:"source:messenger:sticker_subscribe",PHOTO_TAG:"source:messenger:photo_tag",INTERNAL_TEST_PENDING:"source:internal:test_pending",JOB_SEARCH_APPLICATION:"source:job_search:application",MESSENGER_JOINABLE_LINK:"source:messenger:joinable_link",MESSENGER_SMS_BRIDGE_CONVERT:"source:messenger:sms_bridge_conversion",TINCAN_ORCA:"source:tincan:orca",TINCAN_IOS:"source:tincan:ios",TINCAN_UNKNOWN:"source:tincan:unknown",FACEBOOK_GROUPS_CHANNELS:"source:groups:channels",GROUP_COMMERCE:"source:group_commerce",INTERNAL_TOOL:"source:internal:tool",PAGES_PLATFORM:"source:pages:platform",PAGES_RECOMMENDATION:"source:pages:recommendation"};}),null);
__d("MercuryTimePassed",[],(function a(b,c,d,e,f,g){f.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};}),null);
__d("MessagingGenericAdminTextType",[],(function a(b,c,d,e,f,g){f.exports={MADE_POLL_VOTE:"made_poll_vote",GROUP_POLL:"group_poll",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",PHONE_CONTACT_UPLOAD:"phone_contact_upload",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",RTC_INSTANT_VIDEO_LIFECYCLE:"rtc_instant_video_lifecycle",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",SAFETY_LOCATION_REQUEST_SENT:"safety_location_request_sent",SAFETY_LOCATION_REQUEST_RESPONDED:"safety_location_request_responded",SAFETY_LOCATION_REQUEST_DENIED:"safety_location_request_denied",AD_MANAGE_MESSAGE:"ad_manage_message",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",MEDIA_SUBSCRIPTION_MANAGE:"media_subscription_manage",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",MESSENGER_PRECHECKED_PLUGIN:"messenger_prechecked_plugin",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",MN_REF_SEND_TEXT:"mn_ref_send_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel",MESSENGER_OMNIM_CREATE_FLOW:"messenger_omnim_create_flow",MESSENGER_OMNIM_UPDATE_FLOW_STATE:"messenger_omnim_update_flow_state",MESSENGER_GROUP_DESCRITPION_UPDATE:"messenger_group_description_update",MESSENGER_EXTENSION_ADD_CART:"messenger_extension_add_cart",MESSENGER_EXTENSION_ADD_FAVORITE:"messenger_extension_add_favorite",PAGES_PLATFORM_APPOINTMENT_REMINDER:"pages_platform_appointment_reminder",PAGES_PLATFORM_ADMIN_DECLINE:"pages_platform_admin_decline",POKE_RECEIVED:"poke_received",MESSENGER_STATION_SUBSCRIPTION:"messenger_station_subscription",MESSENGER_USER_ALSO_ON_MESSENGER:"messenger_user_also_on_messenger",MESSENGER_INBOX2_BIRTHDAY_BUMP:"messenger_inbox2_birthday_bump",STARTED_SHARING_VIDEO:"started_sharing_video",LIVE_VIDEO_CHAT:"live_video_chat",PARTICIPANT_JOINED_GROUP_CALL:"participant_joined_group_call",MESSENGER_ONLY_PHONE_JOINED_WITH_NEW_ACCOUNT:"messenger_only_phone_joined_with_new_account"};}),null);
__d("MessengerApprovalModeTypes",[],(function a(b,c,d,e,f,g){f.exports={OPEN:0,APPROVALS:1};}),null);
__d("MessengerEmojiConfig",[],(function a(b,c,d,e,f,g){f.exports={emoji_colors:[0,127995,127996,127997,127998,127999]};}),null);
__d("MessengerJoinableModeType",[],(function a(b,c,d,e,f,g){f.exports={PRIVATE:0,JOINABLE:1};}),null);
__d("MessengerThreadCannotReplyReason",[],(function a(b,c,d,e,f,g){f.exports={BLOCKED:"blocked",COMPOSER_DISABLED_BOT:"composer_disabled_bot",HAS_EMAIL_PARTICIPANT:"has_email_participant",OBJECT_ORIGINATED:"object_originated",READ_ONLY:"read_only",VIEWER_NOT_SUBSCRIBED:"viewer_not_subscribed",RECIPIENTS_NOT_LOADABLE:"recipients_not_loadable",RECIPIENTS_UNAVAILABLE:"recipients_unavailable",RECIPIENTS_INVALID:"recipients_invalid",RECIPIENTS_INACTIVE_WORK_ACC:"recipients_inactive_work_account",MONTAGE_NOT_AUTHOR:"montage_not_author"};}),null);
__d("MessengerView",[],(function a(b,c,d,e,f,g){f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent",SUPPORT:"master\/support",SEARCH:"master\/search"}};}),null);
__d("PageMessageEnumTag",[],(function a(b,c,d,e,f,g){f.exports={FLAG:"flag",IMPORTANT:"important",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};}),null);
__d("StickerConstants",[],(function a(b,c,d,e,f,g){f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",OZ_PACK_ID:"1456625217993235",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};}),null);
__d('ChatSearchSource',['requireWeak','AbstractSearchSource','AsyncRequest','CurrentUser','MercuryConfig','MercuryParticipantTypes','SearchableEntry','SearchSourceCallbackManager','ShortProfiles','TokenizeUtil','debounce','emptyFunction','isValidUniqueID'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=null;c('requireWeak')('OrderedFriendsList',function(l){j=l;});h=babelHelpers.inherits(k,c('AbstractSearchSource'));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$ChatSearchSource1=new (c('SearchSourceCallbackManager'))({parseFn:c('TokenizeUtil').parse,matchFn:c('TokenizeUtil').isQueryMatch,indexFn:l.indexFn});this.$ChatSearchSource2=l.queryRequests||[];this.$ChatSearchSource3=false;this.$ChatSearchSource4=c('debounce')(this.$ChatSearchSource4,100,this);}k.prototype.bootstrapImpl=function(l){c('ShortProfiles').fetchAll().done(function(){this.$ChatSearchSource3=true;this.$ChatSearchSource5();l();}.bind(this));};k.prototype.searchImpl=function(l,m,n){var o=null,p={},q=n&&n.onQueryFinished,r=n&&n.onQueryStarted;r&&r(l);var s=this.$ChatSearchSource1.search(l,function(v){if(!o){o=v;o.forEach(function(w){return p[w.getUniqueID()]=true;});}else v.forEach(function(w){var x=w.getUniqueID();if(!p[x]){o.push(w);p[x]=true;}});m(o,l);if(l.length===1&&this.$ChatSearchSource3)q&&q(l);}.bind(this),n);if(!s||!this.$ChatSearchSource2||!this.$ChatSearchSource2.length||l.length===0){q&&q(l);return;}if(l.length===1){if(this.$ChatSearchSource3)q&&q(l);return;}var t={value:l,existing_ids:o&&o.map(function(v){return v.getUniqueID();}).join(','),limit:n&&n.threadLimit},u=this.$ChatSearchSource2.length;this.$ChatSearchSource2.forEach(function(v){this.$ChatSearchSource4(t,v,function(w){this.$ChatSearchSource6(this.$ChatSearchSource7(this.$ChatSearchSource8(w)).filter(function(x){return !!x;}),l);u--;if(u===0){this.$ChatSearchSource1.setQueryStringAsExhausted(l);q&&q(l);}}.bind(this));}.bind(this),this);};k.prototype.getAllEntriesMap=function(){return this.$ChatSearchSource1.getAllEntries();};k.prototype.$ChatSearchSource5=function(){var l=c('ShortProfiles').getCachedProfileIDs(),m=l.filter(function(o){var p=c('ShortProfiles').getNow(o);return (o==c('CurrentUser').getID()||p.type===c('MercuryParticipantTypes').FRIEND||p.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(o.toString())>-1);}),n=m.map(this.$ChatSearchSource9);if(n.length)this.$ChatSearchSource1.addLocalEntries(n);};k.prototype.$ChatSearchSource7=function(l){return l.map(this.$ChatSearchSource10,this);};k.prototype.$ChatSearchSource10=function(l,m){if(l.mercury_thread){if(!j)return null;return j.normalizeThreadEntry(l,m);}var n=l.text,o=l.uid;if(!n||!c('isValidUniqueID')(o))return null;var p=j?j.getActiveRank(o):0;if(j&&!j.contains(o))p+=m;return new (c('SearchableEntry'))({uniqueID:o,title:n,order:p,subtitle:l.subtext,type:l.render_type||l.type,photo:l.photo,uri:l.path,auxiliaryData:{isMessengerUser:l.is_messenger_user,alias:l.alias}});};k.prototype.$ChatSearchSource8=function(l){var m=l.getPayload();if(Array.isArray(m)){return m;}else if(m&&m.entries){return m.entries;}else return [];};k.prototype.$ChatSearchSource9=function(l){var m=c('ShortProfiles').getNow(l),n=l==c('CurrentUser').getID()?c('MercuryParticipantTypes').FRIEND:m.type,o=[m.additionalName,m.alternateName].concat(m.searchTokens||[]).join(' '),p=m.name,q=null;return new (c('SearchableEntry'))({uniqueID:l,title:p,order:j?j.getActiveRank(l):0,subtitle:q,keywordString:o,type:n,photo:m.thumbSrc,uri:m.uri,auxiliaryData:{isMessengerUser:m.is_messenger_user,alias:m.alias}});};k.prototype.$ChatSearchSource4=function(l,m,n,o){new (c('AsyncRequest'))(m.uri).setData(babelHelpers['extends']({},l,m.data)).setMethod('GET').setReadOnly(true).setHandler(n).setErrorHandler(o||c('emptyFunction')).setAllowCrossPageTransition(true).send();};k.prototype.$ChatSearchSource6=function(l,m){if(l.length)this.$ChatSearchSource1.addQueryEntries(l,m);};k.prototype.addLocalEntries=function(l){this.$ChatSearchSource1.addLocalEntries(l);};k.prototype.refreshData=function(){c('ShortProfiles').fetchAll();};f.exports=k;}),null);
__d('NubController',['ArbiterMixin','Dock'],(function a(b,c,d,e,f,g){function h(){}Object.assign(h.prototype,c('ArbiterMixin'),{init:function i(j){this.el=j;c('Dock').registerNubController(j,this);return this;},buttonContentChanged:function i(){this.inform('nub/button/content-changed');},flyoutContentChanged:function i(){this.inform('nub/flyout/content-changed');},hide:function i(){c('Dock').hide(this.el);},show:function i(){c('Dock').show(this.el);}});f.exports=h;}),null);
__d('MercuryMessageClientState',[],(function a(b,c,d,e,f,g){var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;}),null);
__d('MercuryDispatcher',['invariant','ArbiterMixin','LogHistory','MercuryActionType','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','isEmpty','mixin'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('LogHistory').getInstance('mercury_dispatcher');i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n;}l.prototype.handleUpdate=function(n){this.$MercuryDispatcher2(n);!!n.from_client!==!!n.preprocessed||h(0);delete n.preprocessed;if(!c('isEmpty')(n))c('MercuryThreadInformer').getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)this.inform('invalidate-global-state',{});if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform('invalidate-thread-state',o);}this.inform('update-thread-ids',n.newlyAddedClientIDs||{});this.inform('update-participants',n);this.inform('update-threads',n);this.inform('update-unread',n);this.inform('update-threadlist',n);this.inform('update-messages',n);this.inform('update-unseen',n);this.inform('update-typing-state',n);this.inform('update-delivery',n);this.inform('update-roger',n.roger);this.inform('update-blocked-users',n);this.inform('model-update-completed',null);}.bind(this));};l.prototype.$MercuryDispatcher2=function(n){var o=n.payload_source;if(o===c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS||o===c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN)return;var p={from_client:n.from_client,messages:null};if(n.actions){var q=n.actions.filter(function(r){return (r.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE||r.action_type===c('MercuryActionType').LOG_MESSAGE);}).map(function(r){return {action_type:r.action_type,other_user_fbid:r.other_user_fbid,thread_fbid:r.thread_fbid,message_id:r.message_id};});if(q.length)p.messages=q;}k.debug('update:'+o,JSON.stringify(p));};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],(function a(b,c,d,e,f,g){'use strict';var h={generateMessageID:function j(k){var l=k||Date.now(),m=c('randomInt')(0,4294967295),n=c('PresenceUtil').getSessionID();return '<'+l+':'+m+'-'+n+'@mail.projektitan.com>';},generateThreadID:function j(k){return 'root:'+h.generateOfflineThreadingID(k);},generateOfflineThreadingID:function j(k){var l=k||Date.now(),m=c('randomInt')(0,4294967295),n=('0000000000000000000000'+m.toString(2)).slice(-22),o=l.toString(2)+n;return i(o.slice(-63));}};function i(j){var k='';while(j!='0'){var l=0,m='';for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+='1';l-=10;}else m+='0';}k=l.toString()+k;j=m.slice(m.indexOf('1'));}return k;}f.exports=h;}),null);
__d('EmojiLikeConstants',['EmojiStaticConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('EmojiStaticConfig').sizeMap,i={XSMALL:'xsmall',SMALL:'small',MEDIUM:'medium',LARGE:'large'},j={dp16:'xsmall',dp32:'small',dp64:'medium',db64:'medium',dp128:'large'},k={PICKER:'picker',HOT_LIKE:'hot_like'},l=[983040],m='hot_emoji_source',n='hot_emoji_size',o='emoji_like',p='\uD83D\uDC4D',q=[128077];f.exports={FB_THUMBS_UP_EMOJI:l,size:i,sizeMap:h,sizeMapTransfer:j,source:k,SOURCE_TAG_PREFIX:m,TAG_PREFIX_NEW:n,TAG_PREFIX_OLD:o,THUMBS_UP_EMOJI:p,THUMBS_UP_EMOJI_CODES:q};}),null);
__d('SkinToneEmoji',['EmojiFormat','MessengerEmojiConfig'],(function a(b,c,d,e,f,g){'use strict';var h=65039,i={'261d':1,'26f9':1,'270a':1,'270b':1,'270c':1,'270d':1,'1f385':1,'1f3c3':1,'1f3c4':1,'1f3ca':1,'1f3cb':1,'1f442':1,'1f443':1,'1f446':1,'1f447':1,'1f448':1,'1f449':1,'1f44a':1,'1f44b':1,'1f44c':1,'1f44d':1,'1f44e':1,'1f44f':1,'1f450':1,'1f466':1,'1f467':1,'1f468':1,'1f469':1,'1f46e':1,'1f470':1,'1f471':1,'1f472':1,'1f473':1,'1f474':1,'1f475':1,'1f476':1,'1f477':1,'1f478':1,'1f47c':1,'1f481':1,'1f482':1,'1f483':1,'1f485':1,'1f486':1,'1f487':1,'1f4aa':1,'1f575':1,'1f590':1,'1f595':1,'1f596':1,'1f645':1,'1f646':1,'1f647':1,'1f64b':1,'1f64c':1,'1f64d':1,'1f64e':1,'1f64f':1,'1f6a3':1,'1f6b4':1,'1f6b5':1,'1f6b6':1,'1f6c0':1,'1f918':1};function j(s){if(s[s.length-1]===h)return s[s.length-1];return 0;}function k(s){if(s[s.length-1]===h)return s;var t=s.slice(0);t.push(h);return t;}function l(s){if(j(s)===0)return s;return s.slice(0,s.length-1);}function m(s){return p(l(s));}function n(s){var t=c('EmojiFormat').codeArrayToCodeString(m(s));return !!i[t];}function o(s,t){if(t===0)return s;var u=j(s),v=u===0?s.slice(0):s.slice(0,s.length-1);if(q(v)!==0)return s;v.push(t);if(u!==0)v.push(u);return v;}function p(s){var t=j(s),u=t===0?q(s):q(s.slice(0,s.length-1));if(u===0)return s;return t===0?s.slice(0,s.length-1):k(s.slice(0,s.length-2));}function q(s){var t=l(s);if(t.length<=1||!r(t[t.length-1]))return 0;return t[t.length-1];}function r(s){return c('MessengerEmojiConfig').emoji_colors.filter(function(t){return t===s;}).length!==0;}f.exports={addEmojiModifier:k,applyTone:o,getEmojiModifier:j,getTone:q,removeEmojiModifier:l,removeTone:p,emoji:i,hasVariations:n};}),null);
__d('EmojiLikeCxData',['cx','EmojiFormat','EmojiImageURL','EmojiLikeConstants','Image.react','MessengerSupportedEmoji','React','SkinToneEmoji','Utf16','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('EmojiLikeConstants').size,j=c('EmojiLikeConstants').sizeMap,k=c('EmojiLikeConstants').sizeMapTransfer,l=new RegExp('([\u00A9\u00AE\u203C\u2049\u2100-\u21FF'+'\u2300-\u27FF\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uDB80[\uDC00-\uDC01]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),m=new RegExp('([\u0023\u0030-\u0039][\uFE00-\uFE0F]?'+'\u20E3|[\u261D\u270A-\u270C]\uD83C[\uDFFB-\uDFFF]|[\uD83C\uD83D]'+'[\uDC00-\uDFFF]\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDDE6-\uDDFF]\uD83C'+'[\uDDE6-\uDDFF])([\uFE00-\uFE0F])?'),n=new RegExp('(\u20E3|\uD83C[\uDFFB-\uDFFF])'+'([\uFE00-\uFE0F])?'),o=new RegExp('(\uD83C[\uDDE6-\uDDFF])'+'([\uFE00-\uFE0F])?'),p=new RegExp('([\uFE00-\uFE0F])'),q=new RegExp('([\uFE0F])'),r=new RegExp('(\uD83D[\uDC68\uDC69]\u200D)'+'(\uD83D[\uDC68\uDC69]\u200D\uD83D[\uDC66\uDC67]\u200D|'+'\uD83D[\uDC68\uDC69]\u200D|'+'\u2764\uFE0F\u200D\uD83D\uDC8B\u200D|'+'\u2764\uFE0F\u200D)'+'(\uD83D[\uDC66-\uDC69])'),s=new RegExp('([\u200D])'),t='fe0f';function u(){var z;return z={},z[i.XSMALL]="_2560",z[i.SMALL]="_1ifu",z[i.MEDIUM]="_19_r",z[i.LARGE]="_19_s",z;}function v(z,aa){var ba=u(),ca={},da='',ea=null,fa=null,ga=null,ha=r.exec(z);if(ha&&ha.index>0||!ha){fa=l.exec(z);ga=m.exec(z);}if(fa&&fa.length&&ga&&ga.length)if(fa.index<ga.index){ga=null;}else fa=null;if(fa&&ha){ha=fa.index<ha.index?null:ha;}else if(ga&&ha)ha=ga.index<ha.index?null:ha;if(ha&&ha.length){var ia=ha[0],ja=ia.split(s).map(function(ra){if(q.test(ra)){ra=ra.replace(q,'');return c('Utf16').decode(ra).toString(16)+'_'+t;}return c('Utf16').decode(ra).toString(16);});da=ja.join('_');ea=c('MessengerSupportedEmoji').emoji[da];}if(fa&&fa.length){var ka=fa[1];da=c('Utf16').decode(ka).toString(16);ea=c('MessengerSupportedEmoji').emoji[da];}else if(ga&&ga.length){var la=ga[1],ma=o.exec(la),na='',oa='';if(ma&&ma.length){na=ma[1];oa=la.replace(o,'');}else{var pa=n.exec(la);oa=pa[1];na=la.replace(n,'');if(p.test(na))na=na.replace(p,'');}da=c('Utf16').decode(na).toString(16)+'_'+c('Utf16').decode(oa).toString(16);ea=c('MessengerSupportedEmoji').emoji[da];}if(!ea)return false;aa=y(aa);var qa=c('joinClasses')(ba[aa],"_1ift");ca.id=da;ca.url=c('EmojiImageURL').getMessengerURL(da,j[aa]);ca.emoji=c('React').createElement(c('Image.react'),{className:qa,src:ca.url});return ca;}function w(z,aa){if(z.endsWith(t))z=z.replace('_'+t,'');if(!c('MessengerSupportedEmoji').emoji[z])return null;var ba=c('EmojiFormat').codeStringToCodeArray(z),ca=c('EmojiFormat').codeArrayToCodeString(c('SkinToneEmoji').removeEmojiModifier(ba));aa=y(aa);return c('EmojiImageURL').getMessengerURL(ca,j[aa]);}function x(z,aa){aa=y(aa);var ba=u(),ca=c('joinClasses')(ba[aa],"_1ift"),da=c('React').createElement(c('Image.react'),{className:ca,src:w(z,aa)});return da;}function y(z){return k[z]||z;}f.exports={emoji:c('MessengerSupportedEmoji').emoji,getClassSizeMap:u,getNewEmojiData:v,getUrl:w,renderFromSize:x,transferSize:y};}),null);
__d('MercuryTagHelper',[],(function a(b,c,d,e,f,g){'use strict';var h={get:function i(j,k){var l=j.find(function(m){return m.startsWith(k);});return l&&l.substr(l.indexOf(':')+1);}};f.exports=h;}),null);
__d('EmojiLikeUtils',['EmojiLikeConstants','EmojiLikeCxData','EmoticonsList','EmoticonEmojiList','MercuryConfig','MercuryTagHelper','SupportedEmoji','Utf16'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('EmojiLikeConstants').size,k='/images/emoji/unicode/emoji_',l='/images/emoticons/',m=(h={},h[j.SMALL]='_16-2x',h[j.MEDIUM]='_64',h[j.LARGE]='_64',h),n=(i={},i[j.MEDIUM]='-2x',i),o='.png',p='emoji',q='emoticon',r='text',s=new RegExp('([\u203C\u2049\u2100-\u21FF\u2300-\u27FF'+'\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),t=new RegExp('([\u00A9\u00AE\u203C\u2049\u2100-\u21FF'+'\u2300-\u27FF\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),u=new RegExp('([\u0023\u0030-\u0039][\uFE00-\uFE0F]?'+'\u20E3|[\u261D\u270A-\u270C]\uD83C[\uDFFB-\uDFFF]|[\uD83C\uD83D]'+'[\uDC00-\uDFFF]\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDDE6-\uDDFF]\uD83C'+'[\uDDE6-\uDDFF])([\uFE00-\uFE0F])?'),v=new RegExp('(\u20E3|\uD83C[\uDFFB-\uDFFF])'+'([\uFE00-\uFE0F])?'),w=new RegExp('(\uD83C[\uDDE6-\uDDFF])'+'([\uFE00-\uFE0F])?'),x=new RegExp('([\uFE00-\uFE0F])'),y=new RegExp('([\uFE0F])'),z=new RegExp('(\uD83D[\uDC68\uDC69]\u200D)'+'(\uD83D[\uDC68\uDC69]\u200D\uD83D[\uDC66\uDC67]\u200D|'+'\uD83D[\uDC68\uDC69]\u200D|'+'\u2764\uFE0F\u200D\uD83D\uDC8B\u200D|'+'\u2764\uFE0F\u200D)'+'(\uD83D[\uDC66-\uDC69])'),aa=new RegExp('([\u200D])'),ba=new RegExp('(\r\n|[ \r\n]|\s)'),ca='fe0f',da=function ma(na){if(!c('MercuryConfig').BubblelessEmojiRenderingGK)return false;var oa=na||'',ma=[],pa=null;while(oa.length>0&&oa.trim().length>0){var qa=ba.exec(oa),ra='';while(qa&&qa.length&&qa.index===0){ra+=qa[0];oa=oa.replace(ba,'');qa=ba.exec(oa);}if(ra.length>0)ma.push({type:r,text:ra});if(c('EmoticonEmojiList').noncapturingRegexp.test(oa)){pa=c('EmoticonEmojiList').noncapturingRegexp.exec(oa);var sa=c('EmoticonEmojiList').names[pa[1]],ta=c('EmoticonEmojiList').emote2emojis[sa];ma.push({emoji:c('EmojiLikeCxData').renderFromSize(ta,j.SMALL),type:p,title:pa[1],id:ta});oa=oa.replace(pa[1],'');}else{var ua=null,va=null,wa=z.exec(oa);if(wa&&wa.index>0||!wa){ua=t.exec(oa);va=u.exec(oa);}if(ua&&ua.length&&va&&va.length)if(ua.index<va.index){va=null;}else ua=null;if(ua&&wa){wa=ua.index<wa.index?null:wa;}else if(va&&wa)wa=va.index<wa.index?null:wa;if(wa&&wa.length){var xa=wa[0],ya=xa.split(aa).map(function(jb){if(y.test(jb)){jb=jb.replace(y,'');return c('Utf16').decode(jb).toString(16)+'_'+ca;}return c('Utf16').decode(jb).toString(16);}),za=ya.join('_'),ab=c('EmojiLikeCxData').emoji[za];if(!ab)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(za,j.SMALL),id:za,type:p});oa=oa.replace(z,'');continue;}if(va&&va.length){pa=va[1];var bb=w.exec(pa),cb='',db='';if(bb&&bb.length){cb=bb[1];db=pa.replace(w,'');}else{var eb=v.exec(pa);db=eb[1];cb=pa.replace(v,'');if(x.test(cb))cb=cb.replace(x,'');}var fb=c('Utf16').decode(cb).toString(16)+'_'+c('Utf16').decode(db).toString(16),gb=c('EmojiLikeCxData').emoji[fb];if(!gb)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(fb,j.SMALL),id:fb,type:p});oa=oa.replace(u,'');}else if(ua&&ua.length){pa=ua[1];var hb=c('Utf16').decode(pa).toString(16),ib=c('EmojiLikeCxData').emoji[hb];if(!ib)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(hb,j.SMALL),id:hb,type:p});oa=oa.replace(t,'');}else return false;}}return ma;};function ea(ma,na){if(!ma.tags){ma.tags=[fa(na)];}else ma.tags.push(fa(na));return ma;}function fa(ma){var na=c('MercuryConfig').WWWMessengerNewEmojiSizeTagGK?c('EmojiLikeConstants').TAG_PREFIX_NEW:c('EmojiLikeConstants').TAG_PREFIX_OLD;return na+':'+ma;}function ga(ma,na){if(!ma.tags){ma.tags=[ha(na)];}else ma.tags.push(ha(na));return ma;}function ha(ma){return c('EmojiLikeConstants').SOURCE_TAG_PREFIX+':'+ma;}function ia(ma){return ja(ma)!=null;}function ja(ma){if(!ma.tags)return null;var na=c('MercuryTagHelper').get(ma.tags,c('EmojiLikeConstants').TAG_PREFIX_NEW);if(na)return na;return c('MercuryTagHelper').get(ma.tags,c('EmojiLikeConstants').TAG_PREFIX_OLD);}function ka(ma,na){var oa=c('Utf16').decode(ma).toString(16);if(!c('SupportedEmoji').emoji[oa])return null;return (k+oa+m[na]+o);}function la(ma){var na=j.LARGE,oa=j.MEDIUM,pa=[];if(ma)ma.forEach(function(qa){if(qa.type===p){pa.push({emoji:qa.emoji,text:qa.text,title:qa.title,type:qa.type,url:k+qa.id+m[na]+o});}else if(qa.type===q){pa.push({emoji:undefined,text:qa.text,title:qa.title,type:qa.type,url:l+qa.id+n[oa]+o});}else pa.push({emoji:undefined,text:qa.text,title:qa.title,type:qa.type,url:''});});return pa;}f.exports={getEmojiSize:ja,getURI:ka,getSourceURIs:la,isEmojiLike:ia,richContent:da,setEmojiSize:ea,setEmojiSource:ga,EMOJI_TYPE:p,EMOTE_TYPE:q,TEXT_TYPE:r};}),null);
__d('MercuryAttachment',['cx','EmojiLikeUtils','MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','StoryAttachmentStyle'],(function a(b,c,d,e,f,g,h){'use strict';var i=function l(m){return m===Object(m);},j="_1c_u",k={getAttachIconClass:function l(m){switch(m){case c('MercuryAttachmentContentType').PHOTO:return "_y2-";case c('MercuryAttachmentContentType').VIDEO:return "_y2_";case c('MercuryAttachmentContentType').MUSIC:return "_y30";case c('MercuryAttachmentContentType').VOICE:return "_y31";case c('MercuryAttachmentContentType').TEXT:return "_y32";case c('MercuryAttachmentContentType').MSWORD:return "_y33";case c('MercuryAttachmentContentType').MSXLS:return "_y34";case c('MercuryAttachmentContentType').MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function l(m){if(m.startsWith('image')){return "_y2-";}else if(m.startsWith('video')){return "_y2_";}else if(m.startsWith('audio')){return "_y30";}else if(m.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function l(m){if(m.startsWith('image')){return c('MercuryAttachmentContentType').PHOTO;}else if(m.startsWith('video')){return c('MercuryAttachmentContentType').VIDEO;}else if(m.startsWith('audio')){return c('MercuryAttachmentContentType').MUSIC;}else if(m.startsWith('text/plain')){return c('MercuryAttachmentContentType').TEXT;}else return c('MercuryAttachmentContentType').UNKNOWN;},convertRaw:function l(m){var n=[];for(var o=0;o<m.length;o++){var p=m[o];if(p.attach_type===c('MercuryAttachmentType').PHOTO){n.push(p);}else if(p.filename){var q=k.getAttachTypeByMime(p.filetype),r={};r.attach_type=c('MercuryAttachmentType').FILE;r.name=p.filename;r.icon_type=q;r.url='';n.push(r);}}return n;},get:function l(m){var n=[];if(m.attachments){n=m.attachments;}else if(m.raw_attachments)n=this.convertRaw(m.raw_attachments);var o=c('EmojiLikeUtils').getEmojiSize(m);if(o)n=n.concat([{attach_type:c('MercuryAttachmentType').EMOJI_LIKE,size:o}]);if(!(m.attachments&&m.attachments.length>0)){if(m.sticker_id)return n.concat([{attach_type:c('MercuryAttachmentType').STICKER}]);if(m.preview_attachments&&m.preview_attachments.length>0)return n.concat(m.preview_attachments);}return n;},resizeContain:function l(m,n){var o=m.width/m.height,p=n.width/n.height;if(p<o){return {width:Math.ceil(Math.min(m.height*p,n.width)),height:Math.ceil(Math.min(m.height,n.height))};}else return {width:Math.ceil(Math.min(m.width,n.width)),height:Math.ceil(Math.min(m.width/p,n.height))};},isBubblePreferred:function l(m){return this.isFileAttachment(m);},isPhotoAttachment:function l(m){return !!(m.attach_type==c('MercuryAttachmentType').PHOTO||m.attach_type==c('MercuryAttachmentType').ANIMATED_IMAGE||m.attach_type==c('MercuryAttachmentType').THIRDPARTYSTICKER||m.attach_type==c('MercuryAttachmentType').FILE&&m.preview_url);},isVideoAttachment:function l(m){return m.attach_type==c('MercuryAttachmentType').VIDEO;},isShareAttachment:function l(m){return m.attach_type==c('MercuryAttachmentType').SHARE;},isFileAttachment:function l(m){return m.attach_type==c('MercuryAttachmentType').FILE;},isErrorAttachment:function l(m){return m.attach_type==c('MercuryAttachmentType').ERROR;},isStickerAttachment:function l(m){return m.attach_type==c('MercuryAttachmentType').STICKER;},isEmojiLikeAttachment:function l(m){return m.attach_type===c('MercuryAttachmentType').EMOJI_LIKE;},isVoiceAttachment:function l(m){if(!m.metadata)return false;return (m.metadata.type===c('MercuryAudioType').AudioClip||m.metadata.type===c('MercuryAudioType').VoiceMessageWithTranscript);},hasAttribution:function l(m){return !!m.app_attribution;},isSingleVideoAttachment:function l(m){var n=this.get(m).filter(i).filter(function(o){return (this.isVideoAttachment(o));}.bind(this));return n.length===1;},isSharedVideoAttachment:function l(m){var n=m.attach_type===c('MercuryAttachmentType').SHARE&&m.share&&m.share.subattachments&&m.share.subattachments[0];return !!(n&&n.target&&n.target.video_id);},isGenieSharedVideoAttachment:function l(m){return !!(m.attach_type===c('MercuryAttachmentType').SHARE&&m.share&&m.share.style_list.indexOf(c('StoryAttachmentStyle').GENIE_MESSAGE)>-1&&m.share.target&&m.share.target.attachment&&this.isSharedVideoAttachment(m.share.target.attachment));},isSharedVideoAttachmentMessage:function l(m){var n=this.get(m).filter(i).filter(function(o){return (this.isSharedVideoAttachment(o)||this.isGenieSharedVideoAttachment(o));}.bind(this));return n.length===1;},getVideoElem:function l(m,n){var o=n.getMessageElement(m);if(!o)return null;var p=o.getElementsByClassName(j);return p&&p.length?p[0]:o;}};f.exports=k;}),null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],(function a(b,c,d,e,f,g,h){'use strict';var i={renderFilteredContent:function j(k){if(k.is_filtered_content_bh)return h._("Este mensaje se ha eliminado porque contiene enlaces bloqueados o da\u00f1inos.");if(k.is_filtered_content_account)return h._("Este mensaje se ha eliminado temporalmente porque la cuenta del remitente requiere verificaci\u00f3n.");if(k.is_filtered_content_quasar)return h._("Este mensaje se ha eliminado porque incluye contenido bloqueado o da\u00f1ino.");if(k.is_filtered_content_invalid_app)return h._("Este mensaje se ha eliminado porque la aplicaci\u00f3n desde la que se env\u00eda est\u00e1 bloqueada y no puede enviar mensajes.");return h._("Este mensaje se ha eliminado temporalmente porque es necesario verificar la cuenta del remitente, o se ha identificado como abusiva.");}};f.exports=i;}),null);
__d('MercuryGiftSnippetRenderer',['fbt'],(function a(b,c,d,e,f,g,h){'use strict';var i={renderText:function j(k,l){return k?h._("Has enviado un mensaje de San Valent\u00edn."):h._("{name} ha enviado un mensaje de San Valent\u00edn.",[h.param('name',l)]);}};f.exports=i;}),null);
__d('ImageSourceType',[],(function a(b,c,d,e,f,g){var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;}),null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],(function a(b,c,d,e,f,g){function h(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}h.prototype.setFBID=function(l){'use strict';this._request.fbid=l;return this;};h.prototype.setType=function(l){'use strict';if(!c('arrayContains')([c('ImageSourceType').PROFILE_PICTURE,c('ImageSourceType').IMAGE],l))throw new TypeError('ImageSourceRequest.setType: invalid type '+l);this._request.type=l;return this;};h.prototype.setDimensions=function(l,m){'use strict';this._request.width=l;this._request.height=m;return this;};h.prototype.setResizeMode=function(l){'use strict';if(!c('arrayContains')([c('PhotoResizeModeConst').COVER,c('PhotoResizeModeConst').CONTAIN],l))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+l);this._request.resize_mode=l;return this;};h.prototype.setCallback=function(l){'use strict';this._callback=l;return this;};h.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c('MercuryServerDispatcher').trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var i=null;function j(){if(i)return i;var l=new (c('KeyedCallbackManager'))();i=l;c('MercuryServerDispatcher').registerEndpoints({'/ajax/image_source.php':{request_user_id:c('CurrentUser').getID(),mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,batch_function:function m(n,o){var p;(p=n.requests).push.apply(p,o.requests);return n;},handler:function m(n,o){var p=o.getData().requests;for(var q=0;q<p.length;++q)l.setResource(k(p[q]),n[q]);}}});return l;}function k(l){return [l.fbid,l.type,l.width,l.height,l.resize_mode].join('|');}f.exports=h;}),null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],(function a(b,c,d,e,f,g){var h=c('BanzaiLogger').create({retry:true}),i=c('Banzai').isEnabled('mercury_send_error_logging'),j={log:function k(l){if(!i)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};h.log('MercurySendErrorLoggerConfig',m);}};f.exports=j;}),null);
__d('MercuryServerPayloadPreprocessor',['invariant','MessengerEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonProvider','MercuryThreadIDMap','URI'],(function a(b,c,d,e,f,g,h){'use strict';function i(k){this.$MercuryServerPayloadPreprocessor1=k;this.$MercuryServerPayloadPreprocessor2=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c('MercuryDispatcher').getForFBID(this.$MercuryServerPayloadPreprocessor1);}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};i.prototype.handleUpdate=function(k){var l={};!k.from_client||h(0);(k.threads||[]).forEach(function(x){this.$MercuryServerPayloadPreprocessor4(x,l);var y=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(x.thread_id);e(['MercuryServerRequests'],function(z){var aa=z.getForFBID(this.$MercuryServerPayloadPreprocessor1);aa.markThreadFetched(x.thread_id);if(y)aa.markThreadFetched(y);aa.updateLastActionTimestamp(x.timestamp);}.bind(this));}.bind(this));(k.ordered_threadlists||[]).forEach(function(x){var y=x.thread_fbids||[];y=y.concat(x.other_user_fbids||[]);x.thread_ids=y.map(function(z){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(z.toString());}.bind(this));}.bind(this));if(k.pinned_threads&&k.pinned_threads.thread_fbids)k.pinned_threads.thread_fbids=k.pinned_threads.thread_fbids.map(function(x){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);}.bind(this));if(k.delivery_receipts){var m={};for(var n=k.delivery_receipts,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q,s=r.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(r.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(r.thread_fbid);if(s)m[s]=r.time;}k.delivery_receipts=m;}k.actions=k.actions||[];k.actions.forEach(function(x){if(x.action_type===c('MercuryActionType').SEND_MESSAGE&&x.status===c('MercuryActionStatus').ERROR)c('MercurySendErrorLogger').log(x);var y=null,z=null;if(x.other_user_fbid){z=c('MercuryIDs').getThreadIDFromUserID(x.other_user_fbid);y=x.other_user_fbid;}else if(x.thread_fbid){z=c('MercuryIDs').getThreadIDFromThreadFBID(x.thread_fbid);y=x.thread_fbid;}else if(x.thread_id){z=c('MercuryIDs').getThreadIDFromThreadFBID(x.thread_id);y=x.thread_id;}else if(x.status&&x.status!=c('MercuryActionStatus').SUCCESS&&x.client_thread_id){z=x.client_thread_id;}else h(0);y=y&&y.toString();x.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(y)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(y):z;if(x.action_type==c('MercuryActionType').SEND_MESSAGE&&x.client_thread_id&&y){x.thread_id=x.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(y,x.client_thread_id);l[y]=x.client_thread_id;}x.thread_id||h(0);if(!k.payload_source||!k.payload_source.startsWith('server'))e(['MercuryServerRequests'],function(aa){aa.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(x.timestamp);}.bind(this));}.bind(this));this.$MercuryServerPayloadPreprocessor5(k);this.$MercuryServerPayloadPreprocessor6(k);if(k.end_of_history){var t=[];for(var u=0;u<k.end_of_history.length;u++){var v=k.end_of_history[u];if(v.type=='user'){t.push('user:'+v.fbid);}else if(v.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(v.fbid))t.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v.fbid));}k.end_of_history=t;}if(k.roger){var w={};Object.keys(k.roger).forEach(function(x){var y=Object.keys(k.roger[x]),z=void 0;if(x){z=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);}else if(y.length===1)z=c('MercuryIDs').getThreadIDFromUserID(y[0]);if(z){var aa=k.roger[x];w[z]={};for(var ba in aa)if(aa.hasOwnProperty(ba)){var ca=c('MercuryIDs').getParticipantIDFromUserID(ba);w[z][ca]=aa[ba];}}}.bind(this));k.roger=w;}k.newlyAddedClientIDs=l;k.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(k);};i.prototype.$MercuryServerPayloadPreprocessor4=function(k,l){var m=k.other_user_fbid?k.other_user_fbid:k.thread_fbid;m||h(0);var n=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(m);if(!n){n=k.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(k.other_user_fbid):c('MercuryIDs').getThreadIDFromThreadFBID(k.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(m,n);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(k.thread_id,n);l[m]=n;}k.thread_id=n;};i.prototype.$MercuryServerPayloadPreprocessor5=function(k){k.actions.forEach(function(l){if(l.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE){l.attachments=l.attachments||[];l.attachments.forEach(function(m){if(c('MercuryAttachment').isShareAttachment(m)&&c('MessengerEnvironment').messengerui){var n=new (c('URI'))(m.share.uri);if(!n.getDomain())m.share.uri=n.setDomain('facebook.com').setSubdomain(c('URI').getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};i.prototype.$MercuryServerPayloadPreprocessor6=function(k){if(!c('MercuryConfig').MercuryGenieRendering)return;k.actions.forEach(function(l){if(l.action_type!==c('MercuryActionType').USER_GENERATED_MESSAGE)return;var m=l;if(!m.has_attachment||!m.attachments)return;for(var n=m.attachments.length-1;n>=0;n-=1){var o=m.attachments[n];if(!o.share||!o.share.style_list||o.share.style_list[0]!='genie_message')continue;if(o.share.target.genie_id)m.author=c('MercuryIDs').getParticipantIDFromUserID(o.share.target.genie_id);if(o.share.target&&!o.share.target.attachment){m.attachments.splice(n,1);m.has_attachment=m.attachments.length>0;}}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('KeyedCallbackManager'))(),i={getServerIDs:function j(k,l){var m=k.filter(function(o){return o.indexOf('id')===-1;}),n=function o(p){var q=k.map(function(r){return p[r]?p[r]:r;});l(q);};return h.executeOrEnqueue(m,n);},addServerID:function j(k,l){h.setResource(k,l);}};f.exports=i;}),null);
__d('MercuryServerSendMessageQueueOptions',[],(function a(b,c,d,e,f,g){function h(i,j,k,l,m,n){'use strict';this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;}),null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],(function a(b,c,d,e,f,g){var h=9999,i={create:function j(k){var l=new (c('AsyncRequest'))(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new (c('AsyncResponse'))(l,{});Object.assign(m,{error:h,silentError:false,transientError:true,request:l});return m;}};f.exports=i;}),null);
__d("XMessagingSendController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/send\/",{});}),null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError','XMessagingSendController'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('mercury_server_send_message_queue');function i(j,k,l,m){var n;'use strict';this.pending_message=null;this.queue=[];this.sender_id=j;this.queue_id=k;this.$MercuryServerSendMessageQueue2=l.success_handler;this.$MercuryServerSendMessageQueue1=l.error_handler;this.$MercuryServerSendMessageQueue4=l.transport_error_handler;this.$MercuryServerSendMessageQueue3=l.timeout_handler;this.client=m;var o=null;if(c('MercuryServerRequestsConfig').msgrRegion)o={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var p=c('XMessagingSendController').getURIBuilder().getURI().toString(),q=(n={},n[p]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:o,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:l.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:l.connection_retries},n);c('MercuryServerDispatcher').registerEndpoints(q);}i.prototype.enqueue=function(j){'use strict';this.queue.push(j);this.$MercuryServerSendMessageQueue5();};i.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();var j={client:this.client,action_type:this.pending_message.action_type,app_id:this.pending_message.app_id,audio_ids:this.pending_message.audio_ids,body:this.pending_message.body,client_thread_id:this.pending_message.client_thread_id,content_attachment:this.pending_message.content_attachment,ephemeral_ttl_mode:this.pending_message.ephemeral_ttl_mode,file_ids:this.pending_message.file_ids,force_sms:this.pending_message.force_sms,gif_ids:this.pending_message.gif_ids,has_attachment:this.pending_message.has_attachment,image_ids:this.pending_message.image_ids,location_attachment:this.pending_message.location_attachment,log_message_data:this.pending_message.log_message_data,log_message_type:this.pending_message.log_message_type,message_id:this.pending_message.message_id,message_source_data:this.pending_message.message_source_data,offline_threading_id:this.pending_message.offline_threading_id,other_user_fbid:this.pending_message.other_user_fbid,photo_fbids:this.pending_message.photo_fbids,shareable_attachment:this.pending_message.shareable_attachment,signature_id:this.pending_message.signatureID,source:this.pending_message.source,specific_to_list:this.pending_message.specific_to_list,sticker_id:this.pending_message.sticker_id,tags:this.pending_message.tags,thread_fbid:this.pending_message.thread_fbid,timestamp:this.pending_message.timestamp,ui_push_phase:this.pending_message.ui_push_phase,video_ids:this.pending_message.video_ids,platform_xmd:this.pending_message.platform_xmd,profile_xmd:this.pending_message.profile_xmd};for(var k in j)if(j[k]===undefined||j[k]===null)delete j[k];c('MercuryServerDispatcher').trySend(c('XMessagingSendController').getURIBuilder().getURI().toString(),j,null,this.sender_id,this.queue_id);};i.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};i.prototype.$MercuryServerSendMessageQueue8=function(j){'use strict';this.$MercuryServerSendMessageQueue1(c('MercuryServerSendMessageQueueSimulatedError').create(j));h.error('mark_as_failed',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c('MercuryLoggingHelper').obfuscateMessage(j)}));};i.prototype.handleSuccess=function(j,k){'use strict';this.$MercuryServerSendMessageQueue2(j,k);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};i.prototype.handleError=function(j){'use strict';this.$MercuryServerSendMessageQueue1(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.handleTransportError=function(j){'use strict';this.$MercuryServerSendMessageQueue4(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.handleTimeout=function(j){'use strict';this.$MercuryServerSendMessageQueue3(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';h.debug('maybe_send_next_pending_message',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c('MercuryLoggingHelper').obfuscateMessage(this.pending_message),queue:this.queue.map(function(k){return c('MercuryLoggingHelper').obfuscateMessage(k);})}));var j='send_queue.delayed.queue_length.'+this.queue.length.toString();c('BanzaiODS').bumpEntityKey('chat.web',j);};f.exports=i;}),null);
__d('MercurySingletonMixin',['CurrentUser'],(function a(b,c,d,e,f,g){var h={_getInstances:function i(){if(!this._instances)this._instances={};return this._instances;},get:function i(){return this.getForFBID(c('CurrentUser').getID());},getForFBID:function i(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j];}};f.exports=h;}),null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('mercury_server_send_message_queue_router'),i='chat.web.send_queue_router';c('BanzaiODS').setEntitySample(i,.1);function j(k){'use strict';this.queues=new (c('Map'))();this.fbid=k;}j.prototype.enqueue=function(k,l,m,n){'use strict';var o=this.queues.get(k);if(o===undefined){o=new (c('MercuryServerSendMessageQueue'))(this.fbid,k,l,m);this.queues.set(k,o);h.debug('added queue',JSON.stringify({fbid:this.fbid,queue_id:k}));c('BanzaiODS').bumpEntityKey(i,'new_queue');}o.enqueue(n);};Object.assign(j,c('MercurySingletonMixin'));f.exports=j;}),null);
__d("XMercuryUnseenThreadIDsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/unseen_thread_ids\/",{});}),null);
__d("XMessagingChangeMentionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/mercury\/change_mentions_mute_thread\/",{});}),null);
__d('MercuryServerRequests',['errorCode','invariant','Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','CurrentUser','FBID','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryConfig','MercuryDispatcher','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercurySingletonProvider','MercurySourceType','MercuryThreadIDMap','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','PageMessageEnumTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','XMercuryUnseenThreadIDsController','XMessagingChangeMentionsMuteModeController','createObjectFrom','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('LogHistory').getInstance('mercury_server'),k=c('MercuryAPIArgsSource').MERCURY,l=1000,m=30*1000;function n(y){return y.getError()?'_'+y.getError():'';}function o(y,z){var aa=babelHelpers['extends']({},y),ba=void 0;if(z.threads){if(!aa.threads)aa.threads={};for(ba in z.threads)aa.threads[ba]=Object.keys(c('createObjectFrom')((aa.threads[ba]||[]).concat(z.threads[ba])));}if(z.messages){if(!aa.messages)aa.messages={};for(ba in z.messages){if(!aa.messages[ba])aa.messages[ba]={};for(var ca in z.messages[ba])if(aa.messages[ba][ca]){aa.messages[ba][ca]=s(aa.messages[ba][ca],z.messages[ba][ca]);}else aa.messages[ba][ca]=z.messages[ba][ca];}}aa.client=y.client||z.client;return aa;}function p(y,z){var aa=Object.assign(c('createObjectFrom')(y.folders,true),c('createObjectFrom')(z.folders,true)),ba=y.client||z.client;return {folders:Object.keys(aa),client:ba};}function q(y,z){for(var aa in z)if(y[aa]&&typeof y[aa]==='object'){y[aa]=s(y[aa],z[aa]);}else if(z[aa]&&typeof z[aa]==='object'){var ba={};Object.assign(ba,z[aa]);y[aa]=ba;}return y;}function r(y,z){return z;}function s(y,z){var aa=y.offset<z.offset?y.offset:z.offset,ba=y.offset+y.limit,ca=z.offset+z.limit,da=ba>ca?ba:ca,ea=da-aa,fa=y.timestamp>z.timestamp?y.timestamp:z.timestamp;return {offset:aa,limit:ea,timestamp:fa};}function t(y,z){var aa=y.client||z.client,ba={ids:{},client:aa};Object.assign(ba.ids,y.ids,z.ids);return ba;}function u(y,z){var aa={},ba=void 0,ca=y.client||z.client;delete y.client;delete z.client;for(ba in y)Object.assign(aa,c('createObjectFrom')(y[ba],ba));for(ba in z)Object.assign(aa,c('createObjectFrom')(z[ba],ba));var da={client:ca};for(var ea in aa){ba=aa[ea];if(!da[ba])da[ba]=[];da[ba].push(ea);}return da;}function v(y,z){var aa=y.client||z.client,ba=c('createObjectFrom')(y.ids,true),ca=c('createObjectFrom')(z.ids,true),da=Object.assign(ba,ca);return {ids:Object.keys(da),client:aa};}function w(y){this.$MercuryServerRequests1=y;this.$MercuryServerRequests2=0;this.$MercuryServerRequests3={};this.$MercuryServerRequests4={};this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests5=c('MercuryDispatcher').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests7=new (c('MercuryServerSendMessageQueueOptions'))(function(z,aa){this.__handleUpdate(z,aa);}.bind(this),function(z){return this.$MercuryServerRequests8(z);}.bind(this),function(z){this.$MercuryServerRequests9(z);}.bind(this),function(z){return this.$MercuryServerRequests10(z);}.bind(this),c('MercuryServerRequestsConfig').sendMessageTimeout,c('MessagingConfig').SEND_CONNECTION_RETRIES);this.$MercuryServerRequests11();}w.getForFBID=function(y){return x.getForFBID(y);};w.get=function(){return x.get();};w.prototype.fetchThreadlistInfo=function(y,z){var aa=arguments.length<=2||arguments[2]===undefined?c('MessagingTag').INBOX:arguments[2],ba=arguments[3],ca=arguments.length<=4||arguments[4]===undefined?k:arguments[4],da=ba?c('MercuryServerDispatcher').IMMEDIATE:null,ea={client:ca};ea[aa]={offset:y,limit:z,filter:ba};this.__sendRequest('/ajax/mercury/threadlist_info.php',ea,da);};w.prototype.fetchUnseenThreadIDs=function(){var y=arguments.length<=0||arguments[0]===undefined?c('MessagingTag').INBOX:arguments[0],z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c('XMercuryUnseenThreadIDsController').getURIBuilder().getURI().toString(),{});};w.prototype.fetchUnreadThreadIDs=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[y],client:z});};w.prototype.fetchThreadData=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];c('MercuryAssert').allThreadID(y);var aa={threads:{},client:z},ba=[],ca=[];y.forEach(function(ea){if(this.$MercuryServerRequests3[ea])return;this.$MercuryServerRequests3[ea]=true;var fa=this.__threadIDMap.getServerIDFromClientIDNow(ea),ga=c('MercuryIDs').tokenize(ea);if(ga.type=='user'){ba.push(ga.value);aa.threads.user_ids=ba;}else if(ga.type=='thread'){if(fa){ca.push(fa);}else ca.push(ga.value);aa.threads.thread_fbids=ca;}else if(ga.type=='root'){if(fa){ca.push(fa);aa.threads.thread_fbids=ca;}}else if(ga.type!='pending')throw new Error('Unknown thread type',ga);}.bind(this));this.$MercuryServerRequests5.inform('fetch-thread-data',aa);for(var da in aa.threads){this.__sendRequest('/ajax/mercury/thread_info.php',aa);break;}};w.prototype.ensureThreadIsFetched=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!this.__threadIDMap.getClientIDFromServerIDNow(y)&&!this.$MercuryServerRequests3[y]){this.$MercuryServerRequests3[y]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[y]},client:z});}};w.prototype.fetchThreadMessages=function(y,z,aa,ba,ca){var da=arguments.length<=5||arguments[5]===undefined?k:arguments[5];c('MercuryAssert').isThreadID(y);var ea=void 0,fa=void 0,ga=c('MercuryIDs').tokenize(y),ha=this.__threadIDMap.getServerIDFromClientIDNow(y),ia=false;if(ha){ea=ha;fa=ga.type=='user'?'user_ids':'thread_fbids';}else{ea=ga.value;switch(ga.type){case 'user':fa='user_ids';ia=true;break;case 'thread':fa='thread_fbids';break;}}var ja={messages:{},threads:{},client:da};if(fa){ja.messages[fa]={};ja.messages[fa][ea]={offset:z,timestamp:ba,limit:aa};if(ia)ja.threads[fa]=[ea];this.__sendRequest('/ajax/mercury/thread_info.php',ja,ca);}else this.__threadIDMap.getServerIDFromClientID(y,function(ka){ja.messages.thread_fbids={};ja.messages.thread_fbids[ka]={offset:z,timestamp:ba,limit:aa};this.__sendRequest('/ajax/mercury/thread_info.php',ja,ca);}.bind(this));};w.prototype.handleThreadInfoError=function(y){var z=y.getData(),aa=[];if(z.messages){for(var ba in z.messages.thread_fbids){var ca=this.__threadIDMap.getClientIDFromServerIDNow(ba);if(ca)aa.push(this.$MercuryServerRequests12(ca));}for(var da in z.messages.user_ids)aa.push(this.$MercuryServerRequests12('user:'+da));for(var ea in z.messages.group_ids)aa.push(this.$MercuryServerRequests12('group:'+ea));}if(aa.length)this.$MercuryServerRequests5.handleUpdate({actions:aa,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});if(z.threads&&(z.threads.user_ids||z.threads.group_ids||z.threads.thread_ids)){var fa=5,ga=true;if(!z.retry_count){z.retry_count=0;if(z.messages)delete z.messages;}else if(z.retry_count>=fa){ga=false;(z.threads.thread_ids||[]).forEach(function(ia){if(ia in this.$MercuryServerRequests3)delete this.$MercuryServerRequests3[ia];}.bind(this));}if(ga){var ha=Math.pow(2,z.retry_count)*1000;c('setTimeoutAcrossTransitions')(function(){j.log('retry_thread','{}');this.__sendRequest('/ajax/mercury/thread_info.php',z);}.bind(this),ha);z.retry_count++;}}};w.prototype.markFolderAsRead=function(y){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:y});var z=[{action_type:c('MercuryGlobalActionType').MARK_ALL_READ,folder:y}];this.$MercuryServerRequests5.handleUpdate({global_actions:z,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS});};w.prototype.changeThreadReadStatus=function(y,z,aa,ba,ca,da,ea){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(fa){var ga,ha={ids:(ga={},ga[fa]=z,ga),source:aa,watermarkTimestamp:ba,titanOriginatedThreadId:ca,shouldSendReadReceipt:da,commerce_last_message_type:ea};this.__sendRequest('/ajax/mercury/change_read_status.php',ha);}.bind(this));};w.prototype.changeThreadArchivedStatus=function(y,z,aa){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(ba){var ca={ids:{},source:aa};ca.ids[ba]=z;this.__sendRequest('/ajax/mercury/change_archived_status.php',ca);}.bind(this));};w.prototype.changeThreadFolder=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={};ba[z]=[aa];this.__sendRequest('/ajax/mercury/move_thread.php',ba);}.bind(this));};w.prototype.changeMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:aa,mute_settings:z,payload_source:k});}.bind(this));};w.prototype.changeMentionsMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('XMessagingChangeMentionsMuteModeController').getURIBuilder().getURI(),{thread_fbid:aa,mentions_mute_mode:z,payload_source:k});}.bind(this));};w.prototype.markThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:aa,source:z});}.bind(this));};w.prototype.unmarkThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:aa,source:z});}.bind(this));};w.prototype.deleteThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={ids:[aa],source:z};this.__sendRequest('/ajax/mercury/delete_thread.php',ba);}.bind(this));};w.prototype.deleteMessages=function(y,z){c('MercuryMessageIDs').getServerIDs(z||[],function(aa){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:aa});}.bind(this));};w.prototype.sendDeliveryReceipts=function(y,z){c('MercuryMessageIDs').getServerIDs(y||[],function(aa){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:aa,thread_ids:z});}.bind(this));};w.prototype.sendNewMessage=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!y.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','missing_otid_on_send');if(y.client_state&&y.client_state!==c('MercuryMessageClientState').SEND_TO_SERVER)return;var aa=c('MercuryIDs').tokenize(y.thread_id),ba=aa.type,ca=babelHelpers['extends']({},y);ca.thread_id=null;if(ba=='user'){ca.other_user_fbid=aa.value;this.$MercuryServerRequests13(ca,z);}else if(ba=='thread'){ca.thread_fbid=aa.value;this.$MercuryServerRequests13(ca,z);}else if(ba=='root'&&aa.value==ca.offline_threading_id){ca.client_thread_id=y.thread_id;this.$MercuryServerRequests13(ca,z);}else{c('MercuryIDs').isLocalThread(y.thread_id)||i(0);this.__threadIDMap.getServerIDFromClientID(y.thread_id,function(da){ca.thread_fbid=da;this.$MercuryServerRequests13(ca,z);}.bind(this));}};w.prototype.$MercuryServerRequests13=function(y,z){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.$MercuryServerRequests4[y.message_id]=Date.now();c('MercuryServerSendMessageQueueRouter').getForFBID(this.$MercuryServerRequests1).enqueue(y.other_user_fbid||y.thread_fbid||y.client_thread_id,this.$MercuryServerRequests7,z,y);};w.prototype.markSeen=function(){var y=this.$MercuryServerRequests2;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:y});};w.prototype.$MercuryServerRequests14=function(y,z,aa,ba){j.debug('handle_send_message_error_common',JSON.stringify({reliability_error_status:aa,request_error_status:z}));var ca=y.getData(),da=ca.message_batch||[ca],ea=da.map(function(ga){var ha={action_type:c('MercuryActionType').SEND_MESSAGE,other_user_fbid:ga.other_user_fbid,thread_fbid:ga.thread_fbid,client_message_id:ga.message_id,message_id:ga.message_id,client_thread_id:ga.client_thread_id,status:z,error_data:ba};return ha;});ea.forEach(function(ga){if(ga.action_type===c('MercuryActionType').SEND_MESSAGE&&ga.status===c('MercuryActionStatus').ERROR)this.__logMercurySendError(ga);},this);var fa={actions:ea,payload_source:c('MercuryPayloadSource').CLIENT_HANDLE_ERROR};this.$MercuryServerRequests6.handleUpdate(fa);};w.prototype.handleSendMessageError=function(y){var z=y.getPayload(),aa=null,ba=null;if(z&&z.error_payload){aa=c('MercuryActionStatus').UNCONFIRMED;ba='send_error';}else{aa=c('MercuryActionStatus').ERROR;ba='request_error'+n(y);}var ca=y.error;if(ca===1404102)c('AsyncResponse').verboseErrorHandler(y);var da=/<.*>/.test(y.getErrorDescription())?y.getErrorSummary():y.getErrorDescription();this.$MercuryServerRequests14(y.getRequest(),aa,ba,{type:c('MercuryErrorType').SERVER,code:y.getError(),description:da,is_transient:y.isTransient()});};w.prototype.handleSendMessageTransportError=function(y){this.$MercuryServerRequests14(y.getRequest(),c('MercuryActionStatus').ERROR,'transport_error'+n(y),{type:c('MercuryErrorType').TRANSPORT,code:y.getError(),is_transient:true});};w.prototype.handleSendMessageTimeout=function(y){this.$MercuryServerRequests14(y,c('MercuryActionStatus').ERROR,'transport_timeout',{type:c('MercuryErrorType').TIMEOUT,is_transient:true});};w.prototype.getLastActionTimestamp=function(){return this.$MercuryServerRequests2;};w.prototype.__logMercurySendError=function(y){c('MercurySendErrorLogger').log(y);};w.prototype.updateLastActionTimestamp=function(y){var z=Date.now()-1000*60*60*24;if(y&&y>z)this.$MercuryServerRequests2=Math.max(this.$MercuryServerRequests2,y);};w.prototype.markThreadFetched=function(y){delete this.$MercuryServerRequests3[y];};w.prototype.$MercuryServerRequests12=function(y){return {action_type:c('MercuryActionType').LOG_MESSAGE,thread_id:y,message_id:y,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:c('MercurySourceType').UNKNOWN,log_message_body:'',log_message_type:c('MercuryLogMessageType').SERVER_ERROR,log_message_data:{}};};w.prototype.__getForAsyncRequest=function(y){var z=y.getData(),aa=z.request_user_id?z.request_user_id:c('CurrentUser').getID();return w.getForFBID(aa);};w.prototype.__handleUpdate=function(y,z){this.__getForAsyncRequest(z).$MercuryServerRequests6.handleUpdate(y);};w.prototype.$MercuryServerRequests15=function(y){var z=this.__getForAsyncRequest(y);z.handleThreadInfoError(y);};w.prototype.$MercuryServerRequests8=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageError(y);};w.prototype.$MercuryServerRequests9=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageTransportError(y);};w.prototype.$MercuryServerRequests10=function(y){var z=this.__getForAsyncRequest(y);z.handleSendMessageTimeout(y);};w.prototype.$MercuryServerRequests11=function(){var y=null;if(c('MercuryServerRequestsConfig').msgrRegion)y={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var z={'/ajax/mercury/thread_info.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,customHeader:y,batch_function:o,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this),error_handler:function(ca){return (this.$MercuryServerRequests15(ca.getRequest()));}.bind(this),timeout_handler:function(ca){return this.$MercuryServerRequests15(ca);}.bind(this),timeout:m},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:r,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:y,batch_function:q,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:y,batch_function:p,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/chat/settings.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y},'/ajax/mercury/change_archived_status.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:t,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:v,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:u,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)}},aa=c('XMercuryUnseenThreadIDsController').getURIBuilder().getURI().toString();z[aa]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)};var ba=c('XMessagingChangeMentionsMuteModeController').getURIBuilder().getURI().toString();z[ba]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(ca,da){return this.__handleUpdate(ca,da);}.bind(this)};c('MercuryServerDispatcher').registerEndpoints(z);};w.prototype.__sendRequest=function(y,z,aa){c('MercuryServerDispatcher').trySend(y,z,aa,this.$MercuryServerRequests1);};w.prototype.__getFBID=function(){return this.$MercuryServerRequests1;};var x=new (c('MercurySingletonProvider'))(w);f.exports=w;}),null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new (c('KeyedCallbackManager'))();this.$MercuryThreadIDMap3=new (c('KeyedCallbackManager'))();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return;}this.forceSetServerIDToClientID(j,k);};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j);};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k);};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j);};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j);}.bind(this));};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j);};h.prototype.getServerIDFromClientID=function(j,k){c('MercuryAssert').isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c('MercuryIDs').tokenize(j);if(n.length&&o.type!='root')m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n);}.bind(this));};h.prototype.hasClientIDForServerID=function(j){return !!this.getClientIDFromServerIDNow(j);};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j;};h.prototype.canLinkExternally=function(j){c('MercuryAssert').isThreadID(j);var k=c('MercuryIDs').tokenize(j);return k.type=='user'||!!this.getServerIDFromClientIDNow(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('short_profiles');function i(k){this.$MercuryParticipantFetcher4=c('MercuryServerPayloadPreprocessor').getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new (c('Set'))();this.$MercuryParticipantFetcher3=new (c('Set'))();}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher5(k);this.$MercuryParticipantFetcher6();};i.prototype.fetchMulti=function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher5(l);}.bind(this));this.$MercuryParticipantFetcher6();};i.prototype.$MercuryParticipantFetcher5=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k);};i.prototype.$MercuryParticipantFetcher6=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c('setImmediate')(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k);}.bind(this));this.$MercuryParticipantFetcher7(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3['delete'](l.id);}.bind(this));this.$MercuryParticipantFetcher8(k);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};i.prototype.$MercuryParticipantFetcher7=function(k,l){var m=[];k.forEach(function(n){var o=c('MercuryIDs').tokenize(n),p=o.type,q=o.value;p==='fbid'&&m.push(q);});if(m.length>0){c('ShortProfiles').getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error('server_fetch_participant_count_error',JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}));});h.debug('client_fetch_participants',JSON.stringify({userIDs:m}));}};i.prototype.$MercuryParticipantFetcher8=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c('MercuryPayloadSource').SERVER_FETCH_PARTICIPANTS});};function j(k,l){var m=babelHelpers['extends']({gender:k.gender,fbid:k.id||l,href:k.uri,id:c('MercuryIDs').getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation;}if(k.timezone||k.timezone===0)m.timezone=k.timezone;if(k.personal_id)m.personal_id=k.personal_id;if(k.work_id)m.work_id=k.work_id;return m;}f.exports=i;}),null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('Map'))(),i=new (c('Map'))(),j={getID:function k(l){return h.get(l.toLowerCase());},getVanity:function k(l){return i.get(l);},hasID:function k(l){return i.has(l);},hasVanity:function k(l){return h.has(l.toLowerCase());},set:function k(l,m){c('MercuryAssert').isParticipantID(m);var n=l.toLowerCase();h.set(n,m);i.set(m,n);}};f.exports=j;}),null);
__d('MercuryParticipants',['fbt','CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i='change';function j(l){this.$MercuryParticipants1=l;this.$MercuryParticipants2=new (c('EventEmitter'))();this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();this.$MercuryParticipants4=new (c('MercuryParticipantFetcher'))(this.$MercuryParticipants1);this.$MercuryParticipants5=c('MercuryDispatcher').getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants);}.bind(this));this.$MercuryParticipants5.subscribe('invalidate-global-state',function(){this.$MercuryParticipants7();}.bind(this));}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m);};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c('MercuryVanityIDMap').hasVanity(l))return c('MercuryVanityIDMap').getID(l);if(/^\d+$/.test(l))return c('MercuryIDs').getParticipantIDFromUserID(l);return undefined;};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l);};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m;};j.prototype.get=function(l,m){c('MercuryAssert').isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l]);});};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m);};j.prototype.getBigImageMulti=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=c('MercuryParticipantsConstants').BIG_IMAGE_SIZE;return this.$MercuryParticipants9(l,function(o){var p={},q=0,r=new (c('Set'))(),s=function(w,x){q++;p[w]=x;if(q===l.length){m(p);if(r.size>0)this.$MercuryParticipants10(r);}}.bind(this),t=function(w,x){this.$MercuryParticipants3.setResource(w,c('ImmutableObject').set(this.$MercuryParticipants3.getResource(w),{big_image_src:x.uri}));r.add(w);s(w,x.uri);}.bind(this);for(var u in o){var v=o[u];if(!v.big_image_src){new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(u)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(t.bind(null,u)).send();}else s(v.id,v.big_image_src);}}.bind(this));};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o];}));});};j.prototype.$MercuryParticipants9=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){var q=c('MercuryIDs').tokenize(p),r=q.type,s=q.value;if(r==='email'){this.$MercuryParticipants11(p,s);return false;}if(r==='name'){this.$MercuryParticipants12(p,s);return false;}return true;}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n);};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c('MercuryIDs').tokenize(l),o=n.type,p=n.value;if(o==='email')m=this.$MercuryParticipants11(l,p);if(o==='name')m=this.$MercuryParticipants12(l,p);}return m;};j.prototype.$MercuryParticipants11=function(l,m){var n=new (c('ImmutableObject'))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants12=function(l,m){var n=new (c('ImmutableObject'))({gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l);};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id;});l=l.map(function(n){if(n.vanity)c('MercuryVanityIDMap').set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c('ImmutableObject').set(o,n):new (c('ImmutableObject'))(this.$MercuryParticipants14(n));}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c('createObjectFrom')(m,l));this.$MercuryParticipants10(new (c('Set'))(m));};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c('MercuryParticipantTypes').USER||l.type===c('MercuryParticipantTypes').FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Usuario de Facebook");l.name=n;l.short_name=n;}return l;};j.prototype.$MercuryParticipants13=function(l){return {remove:function(){this.$MercuryParticipants3.unsubscribe(l);}.bind(this)};};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();};function k(l,m){return {gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false,fbid:undefined,accepts_messenger_user_feedback:undefined,is_business_enabled:undefined,is_messenger_platform_bot:undefined,is_employee_away:undefined,is_friend:undefined,is_messenger_user:undefined,is_verified:undefined,type:undefined,vanity:undefined,timezone:undefined,personal_id:undefined,work_id:undefined};}f.exports=new j(c('CurrentUser').getID());}),null);
__d('MercurySyncDeltaTypes',[],(function a(b,c,d,e,f,g){'use strict';var h={AdminAddedToGroupThread:'AdminAddedToGroupThread',AdminRemovedFromGroupThread:'AdminRemovedFromGroupThread',AdminTextMessage:'AdminTextMessage',DeliveryReceipt:'DeliveryReceipt',ForcedFetch:'ForcedFetch',MarkRead:'MarkRead',MarkUnread:'MarkUnread',MessageDelete:'MessageDelete',NewMessage:'NewMessage',PagesManagerEvent:'PagesManagerEvent',ParticipantLeftGroupThread:'ParticipantLeftGroupThread',ParticipantsAddedToGroupThread:'ParticipantsAddedToGroupThread',ReadReceipt:'ReadReceipt',ReplaceMessage:'ReplaceMessage',RTCEventLog:'RTCEventLog',ThreadAction:'ThreadAction',ThreadDelete:'ThreadDelete',ThreadMuteSettings:'ThreadMuteSettings',ThreadName:'ThreadName',JoinableMode:'JoinableMode',ApprovalMode:'ApprovalMode',ApprovalQueue:'ApprovalQueue',ClientPayload:'ClientPayload',GenieMessage:'GenieMessage',MontageMessage:'MontageMessage',RtcCallData:'RtcCallData'};f.exports=h;}),null);
__d('MercurySyncFakeDFFSender',['Arbiter','ChannelConstants','MercurySingletonProvider','MercurySyncDeltaTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF);i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncFakeDFFSender1=k;}i.prototype.sendGlobalDFF=function(){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch},queue:this.$MercurySyncFakeDFFSender1}});};i.prototype.sendThreadDFF=function(k,l){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}},queue:this.$MercurySyncFakeDFFSender1}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs','MessengerThreadCannotReplyReason'],(function a(b,c,d,e,f,g){'use strict';var h={canReply:function j(k){return !!(k.is_subscribed&&(k.can_reply===undefined||k.can_reply)&&!k.has_email_participant&&!k.read_only);},getMuteSetting:function j(k){return !k.mute_until?undefined:k.mute_until;},isEmptyLocalThread:function j(k){return (c('MercuryIDs').tokenize(k.thread_id).type==='root'&&!k.timestamp);},isMuted:function j(k){return h.getMuteSetting(k)!==undefined;},areMentionsMuted:function j(k){return k.mentions_mute_mode===1;},isNewEmptyLocalThread:function j(k){return !!(h.isEmptyLocalThread(k)&&k.participants&&k.participants.length===0);},showComposer:function j(k){return !!(k.is_subscribed&&(k.can_reply||!k.cannot_reply_reason||k.cannot_reply_reason===c('MessengerThreadCannotReplyReason').BLOCKED)&&!k.has_email_participant&&!k.read_only);},isColdOpen:function j(k){return !!(k.is_canonical_user&&(k.message_count===0||!k.timestamp));}};function i(j){return j+'@facebook.com';}f.exports=h;}),null);
__d('MessagingGiftWrapConstants',[],(function a(b,c,d,e,f,g){'use strict';var h='gift_wrap',i='gift_unwrapped',j='valentines2016';f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j};}),null);
__d('MessagingGiftWrapChecker',['MercuryConfig','MercuryTagHelper','MessagingGiftWrapConstants'],(function a(b,c,d,e,f,g){'use strict';var h={shouldRenderWithGiftWrap:function k(l){return !!(c('MercuryConfig').GiftWrapViewerGK&&l.tags&&i(l.tags)&&!j(l.tags));}};function i(k){return c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;}function j(k){return !!c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);}f.exports=h;}),null);
__d('MercuryThreads',['invariant','EventEmitter','MercuryDisplayTimeFilterMessageRenderer','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryGiftSnippetRenderer','MercuryGlobalActionType','MercuryIDs','MercuryLocalIDs','MercuryLoggingHelper','MercuryLogMessageType','MercuryParticipants','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MercuryThreadInfo','MercuryThreadInformer','MessagingGenericAdminTextType','MessagingGiftWrapChecker','MessagingTag','Set','emptyFunction','ifRequired','requireWeak','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_threads');function k(m){this.$MercuryThreads1=m;this.$MercuryThreads2=c('MercuryServerRequests').getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c('MercuryThreadInformer').getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c('MercuryDispatcher').getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=c('MercurySyncFakeDFFSender').getForFBID(this.$MercuryThreads1);this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();this.$MercuryThreads13();}k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};k.prototype.getThreadMetaNow=function(m){c('MercuryAssert').isThreadID(m);return this.$MercuryThreads8.getResource(m);};k.prototype.getOrFetch=function(m){var n=this.getThreadMetaNow(m);if(!n&&!this.$MercuryThreads12.has(m))this.$MercuryThreads11.add(m);if(this.$MercuryThreads11.size>0&&!this.$MercuryThreads10)this.$MercuryThreads14();return n;};k.prototype.$MercuryThreads14=function(){if(this.$MercuryThreads10)return;this.$MercuryThreads10=true;c('setImmediate')(function(){this.$MercuryThreads10=false;this.$MercuryThreads11.forEach(function(m){return this.$MercuryThreads12.add(m);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads11),function(m){for(var n in m)m.hasOwnProperty(n)&&this.$MercuryThreads12['delete'](n);}.bind(this));this.$MercuryThreads11.clear();}.bind(this));};k.prototype.getThreadMeta=function(m,n,o){return this.getMultiThreadMeta([m],function(p){return n(p[m]);},o);};k.prototype.getMultiThreadMeta=function(m,n,o){c('MercuryAssert').allThreadID(m);var p=this.$MercuryThreads8.executeOrEnqueue(m,n),q=this.$MercuryThreads8.getUnavailableResources(p);if(q.length){var r=[];for(var s=0;s<q.length;s++){var t=q[s],u=c('MercuryIDs').tokenize(t),v=u.type,w=u.value;if(v=='user'){var x=c('MercuryIDs').getParticipantIDFromUserID(w);this.createNewLocalThread(t,x===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,x]);}r.push(t);}if(r.length)this.$MercuryThreads2.fetchThreadData(r,o);}return p;};k.addListener=function(m,n){return i.addListener(m,n);};k.prototype.unsubscribe=function(m){this.$MercuryThreads8.unsubscribe(m);};k.prototype.getCanonicalThreadToParticipant=function(m,n,o,p){var q=c('MercuryIDs').getThreadIDFromParticipantID(m);!!q||h(0);var r=this.$MercuryThreads8.getResource(q);if(r==undefined){r=this.createNewLocalThread(q,this.$MercuryThreads4===m?[this.$MercuryThreads4]:[this.$MercuryThreads4,m],n);!p&&this.$MercuryThreads2.fetchThreadData([q],o);}return r;};k.prototype.createNewLocalThread=function(m,n,o){var p=this.$MercuryThreads8.getResource(m);if(!p){var q=c('MercuryIDs').tokenize(m),r=q.type,s=q.value;p=new (c('ImmutableObject'))({thread_id:m,participants:Array.from(n),name:'',snippet:'',snippet_sender:null,unread_count:o?o:0,message_count:0,image_src:null,timestamp:null,other_user_fbid:r==='user'?s:null,is_canonical_user:r=='user',is_canonical:this.$MercuryThreads15(n),is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});this.$MercuryThreads8.setResource(m,p);}return p;};k.prototype.createNewLocalThreadGenerateID=function(){var m=c('MercuryLocalIDs').generateThreadID();this.createNewLocalThread(m,[]);return m;};k.prototype.isEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isEmptyLocalThread(n);};k.prototype.isNewEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isNewEmptyLocalThread(n);};k.prototype.$MercuryThreads16=function(m,n){if(!m||!m.length)return;var o=new (c('Map'))(),p=new (c('Map'))(),q=new (c('Map'))(),r=[];for(var s=0;s<m.length;s++){var t=m[s];if(t.is_forward)continue;var u=t.action_type;if(u==c('MercuryActionType').LOG_MESSAGE&&t.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)continue;var v=!!(t.sync_id||t.is_from_iris),w=t.thread_id;c('MercuryAssert').isThreadID(w);var x=this.$MercuryThreads8.getResource(w);if(!x&&!v&&u==c('MercuryActionType').USER_GENERATED_MESSAGE){x=this.$MercuryThreads17(t);if(x.participants){this.$MercuryThreads8.setResource(w,x);}else j.debug('missing_local_participants',JSON.stringify(t));}if(!x)continue;if(u==c('MercuryActionType').LOG_MESSAGE||u==c('MercuryActionType').USER_GENERATED_MESSAGE)v=!n;if(x.server_timestamp&&t.timestamp<=x.server_timestamp&&v)continue;if(!q.has(w))q.set(w,babelHelpers['extends']({},x));this.$MercuryThreads18(q.get(w),t,n);var y=o.get(w);if(u==c('MercuryActionType').USER_GENERATED_MESSAGE&&(!y||t.timestamp>y.timestamp))o.set(w,t);if((u==c('MercuryActionType').USER_GENERATED_MESSAGE||u==c('MercuryActionType').LOG_MESSAGE)&&!t.skip_bump_thread)if(t&&t.timestamp&&(!p.has(w)||t.timestamp>p.get(w).timestamp))p.set(w,t);}q.forEach(function(z,aa){var ba=p.get(aa),ca=o.get(aa);if(ca){this.$MercuryThreads19(z,ca);}else if(ba&&ba.log_message_body){var da=babelHelpers['extends']({},ba,{body:ba.log_message_body});this.$MercuryThreads19(z,da);}var ea=z.timestamp;if(ba){if(ba.timestamp>ea)Object.assign(z,{timestamp:ba.timestamp});var fa=z.server_timestamp;if(!n&&ba.timestamp>fa)z.server_timestamp=ba.timestamp;}var ga=new (c('ImmutableObject'))(z);this.$MercuryThreads8.setResource(aa,ga);r.push(c('MercuryLoggingHelper').obfuscateThread(ga));}.bind(this),this);r.length&&this.$MercuryThreads7&&j.debug('threads_updated',JSON.stringify({threads:r}));};k.prototype.$MercuryThreads18=function(m,n,o){var p=n.action_type;if(p==c('MercuryActionType').USER_GENERATED_MESSAGE||p==c('MercuryActionType').LOG_MESSAGE){if(n.is_unread||n.skip_bump_thread)if(!(m.unread_count===0&&n.skip_bump_thread))m.unread_count++;m.message_count++;m.is_archived=false;}switch(p){case c('MercuryActionType').DELETE_THREAD:m.message_count=0;this.$MercuryThreads20(n.thread_id);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:if(m.unread_count===0&&n.author===this.$MercuryThreads4&&n.timestamp>=m.last_read_timestamp)m.last_read_timestamp=n.timestamp;if(n.offline_threading_id!==n.message_id)m.last_message_timestamp=n.timestamp;this.$MercuryThreads21(m,n.author);break;case c('MercuryActionType').SEND_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').THREAD_IMAGE){m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;this.$MercuryThreads22(n.thread_id);}if(q!==c('MercuryLogMessageType').SUBSCRIBE&&q!==c('MercuryLogMessageType').UNSUBSCRIBE)m.snippet_attachments=n.attachments;break;case c('MercuryActionType').LOG_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').SUBSCRIBE){this.$MercuryThreads23(m,n.log_message_data.added_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').UNSUBSCRIBE){this.$MercuryThreads24(m,n.log_message_data.removed_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').THREAD_IMAGE){if(!o)m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;}else if(q==c('MercuryLogMessageType').THREAD_NAME){if(m.name!==n.log_message_data.name)this.$MercuryThreads22(n.thread_id);m.name=n.log_message_data.name;}else if(q===c('MercuryLogMessageType').GENERIC_ADMIN_TEXT)this.$MercuryThreads25(m,n);break;case c('MercuryActionType').CHANGE_READ_STATUS:var r=this.$MercuryThreads26(m,n,n.mark_as_read);if(r)m.last_read_timestamp=m.last_message_timestamp;var s=!m.read_only&&m.folder===c('MessagingTag').INBOX;if(r&&o)this.$MercuryThreads2.changeThreadReadStatus(m.thread_id,n.mark_as_read,n.source,m.last_read_timestamp,m.titan_originated_thread_id,s,m.last_message_type);break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:if(m.is_archived!=n.archived){m.is_archived=n.archived;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').CHANGE_FOLDER:if(m.folder!=n.new_folder){m.folder=n.new_folder;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').DELETE_MESSAGES:if(o){m.snippet='...';m.snippet_attachments=null;m.snippet_sender=null;this.$MercuryThreads22(n.thread_id);}else if(n.message_ids){m.message_count-=n.message_ids.length;c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);for(var v=n.message_ids,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=u.getMessagesFromIDs([z]),ba=aa[0];if(ba&&ba.timestamp>m.last_read_timestamp)m.unread_count=Math.max(0,m.unread_count-1);}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));}break;case c('MercuryActionType').UPDATE_SNIPPET:c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);var v=0,w=1,x=u.getThreadMessagesRangeNow(n.thread_id,v,w),y=x[0];if(y){m.snippet=y.body;m.snippet_attachments=y.attachments;m.snippet_sender=y.author;}else{m.snippet='...';m.snippet_attachments=null;m.snippet_sender=null;u.getThreadMessagesRange(n.thread_id,v,w,function(z){if(z.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:n.thread_id,action_type:c('MercuryActionType').UPDATE_SNIPPET,deleted_ids:n.deleted_ids}]});}.bind(this));}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));break;case c('MercuryActionType').CHANGE_MUTE_SETTINGS:if(n.hasOwnProperty('mentions_mute_mode')){m.mentions_mute_mode=n.mentions_mute_mode;}else m.mute_until=!n.mute_until?undefined:n.mute_until;this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').ADD_PARTICIPANTS:this.$MercuryThreads23(m,n.participants);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').CHANGE_FLAG:this.$MercuryThreads27(m,n.mark_as_flag);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').UPDATE_PRIORITY:this.$MercuryThreads28(m,n.mark_as_priority);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').MOVE_PENDING_TO_INBOX:this.$MercuryThreads29(m);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').UPDATE_CUSTOM_LIKE:m.custom_like_icon=n.custom_like;this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').ADD_GROUP_ADMINS:m.admin_ids=m.admin_ids.concat(n.added_admin_ids.filter(function(u){return m.admin_ids.indexOf(u)===-1;}));this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').REMOVE_GROUP_ADMINS:m.admin_ids=m.admin_ids.filter(function(u){return n.removed_admin_ids.indexOf(u)===-1;});this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').JOINABLE_MODE:m.joinable_mode=n.joinable_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_MODE:m.approval_mode=n.approval_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_QUEUE:if(n.added_id&&m.approval_queue_ids&&m.approval_queue_ids.indexOf(n.added_id)===-1)m.approval_queue_ids=m.approval_queue_ids.concat(n.added_id);if(n.removed_id&&m.approval_queue_ids)m.approval_queue_ids=m.approval_queue_ids.filter(function(u){return n.removed_id!==u;});this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').IS_PIN_PROTECTED:m.is_pin_protected=n.is_pin_protected;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').UPDATE_RTC_CALL_DATA:var t=n.initiator_fbid||(m.rtc_call_data?m.rtc_call_data.initiator_fbid:undefined);m.rtc_call_data=new (c('ImmutableObject'))({call_state:n.call_state,server_info_data:n.server_info_data,initiator_fbid:t});this.$MercuryThreads22(n.thread_id);break;}};k.prototype.$MercuryThreads25=function(m,n){var o,p=this;if(n.log_message_data&&n.log_message_data.untypedData)(function(){var q=n.log_message_data.untypedData,event=m.lightweight_event;switch(n.log_message_data.message_type){case c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE:var r=parseInt(q.ttl,10);if(r!==null&&m.ephemeral_ttl_mode!==r){m.ephemeral_ttl_mode=r;p.$MercuryThreads22(n.thread_id);}break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_NICKNAME:var s={};for(var t in m.custom_nickname){if(t==q.participant_id&&q.nickname.trim().length==0)continue;s[t]=m.custom_nickname[t];}if(q.nickname.trim().length>0)s[q.participant_id]=q.nickname;m.custom_nickname=s;p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_ICON:c('requireWeak')('MercuryThreadActions',function(v){v.getForFBID(this.$MercuryThreads1).updateCustomLike(n.thread_id,q.thread_icon);}.bind(p));break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_THEME:var u=q.theme_color;if(u.length>0){m.custom_color='#'.concat(u.substring(2));}else m.custom_color=null;p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_CREATE:m.lightweight_event={title:q.event_title,event_time:parseInt(q.event_time,10),unified_location_name:null,oid:q.event_id};p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_UPDATE:case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_UPDATE_TIME:case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_UPDATE_TITLE:case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_UPDATE_LOCATION:if(event)m.lightweight_event=p.$MercuryThreads30(q,event);p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_DELETE:case c('MessagingGenericAdminTextType').LIGHTWEIGHT_EVENT_NOTIFY:m.lightweight_event=null;p.$MercuryThreads22(n.thread_id);break;}})();};k.prototype.$MercuryThreads30=function(m,event){return {title:m.event_title===undefined?event.title:m.event_title,event_time:m.event_time===undefined?event.event_time:parseInt(m.event_time,10),unified_location_name:m.event_location_name===undefined?event.unified_location_name:m.event_location_name,oid:event.oid};};k.prototype.$MercuryThreads17=function(m){var n=c('MercuryIDs').tokenize(m.thread_id),o=n.type,p=n.value,q=m.specific_to_list&&this.$MercuryThreads15(m.specific_to_list);return new (c('ImmutableObject'))({thread_id:m.thread_id,participants:m.specific_to_list,name:null,snippet:m.body,snippet_attachments:[],snippet_sender:m.author,unread_count:0,message_count:0,image_src:null,timestamp:m.timestamp,other_user_fbid:o==='user'?p:null,is_canonical_user:o==='user',is_canonical:q,is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});};k.prototype.$MercuryThreads26=function(m,n,o){if(n.timestamp)this.$MercuryThreads31(m.thread_id,o,n.timestamp);if(!m||!m.thread_id)return false;if(!m.timestamp){this.$MercuryThreads9.add(m.thread_id);return false;}var p=!m.unread_count;if(o==p)return false;m.unread_count=o?0:1;this.$MercuryThreads22(m.thread_id);return true;};k.prototype.$MercuryThreads32=function(m){var n=this.$MercuryThreads8.getAllResources();for(var o in n)if(n.hasOwnProperty(o)){var p=n[o];if(p.folder==m){this.$MercuryThreads8.setResource(o,c('ImmutableObject').setProperty(p,'unread_count',0));this.$MercuryThreads22(o);}}};k.prototype.$MercuryThreads23=function(m,n){var o=new (c('Set'))(m.participants);m.participants=Array.from(m.participants);n.forEach(function(p){if(!o.has(p)){m.participants.push(p);if(p===this.$MercuryThreads4){m.is_subscribed=true;m.can_reply=true;m.cannot_reply_reason=null;this.$MercuryThreads6.sendThreadDFF(undefined,m.thread_fbid);}}}.bind(this));};k.prototype.$MercuryThreads24=function(m,n){var o=new (c('Set'))(n);m.participants=m.participants.filter(function(p){return !o.has(p);});m.admin_ids=m.admin_ids.filter(function(p){return !o.has(p);});if(o.has(this.$MercuryThreads4))m.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([m.thread_id]);};k.prototype.$MercuryThreads21=function(m,n){if(!m.participants){var o=JSON.stringify({thread_info:m,participant:n});j.debug('missing_participants',o);return;}var p=m.participants.indexOf(n);if(p>0)m.participants=[n].concat(m.participants.slice(0,p),m.participants.slice(p+1));};k.prototype.$MercuryThreads19=function(m,n){var o=n.body,p=n.subject,q='';if(p){p=p.toLowerCase();if(o.slice(0,p.length).toLowerCase()==p){q=o;}else if(o){q=p+' \u00B7 '+o;}else q=p;}else q=o;if(n.is_filtered_content)q=c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(n);if(c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(n)){var r=n.author,s=r==this.$MercuryThreads4,t=null;if(!s){t=m.custom_nickname&&m.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(r)];if(!t){var u=c('MercuryParticipants').getNow(r);if(u!=null)t=u.short_name;}}q=c('MercuryGiftSnippetRenderer').renderText(s,t);}m.snippet=q;if(n.raw_attachments&&n.raw_attachments.length>0){var v=c('MercuryAttachment').convertRaw(n.raw_attachments);m.snippet_attachments=v;}else m.snippet_attachments=n.attachments;if(n.log_message_type){m.snippet_sender=null;}else m.snippet_sender=n.author;};k.prototype.$MercuryThreads27=function(m,n){m.page_thread_info=babelHelpers['extends']({},m.page_thread_info,{flagged:n});};k.prototype.$MercuryThreads28=function(m,n){m.page_thread_info=babelHelpers['extends']({},m.page_thread_info,{is_priority:n});};k.prototype.$MercuryThreads29=function(m){if(m.folder!==c('MessagingTag').PENDING)return;m.folder=c('MessagingTag').INBOX;};k.prototype.$MercuryThreads15=function(m){return m.filter(function(n){return n!=this.$MercuryThreads4;}.bind(this)).length<=1;};k.prototype.$MercuryThreads13=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',function(m,n){return this.$MercuryThreads33(n);}.bind(this));this.$MercuryThreads5.subscribe('invalidate-global-state',function(m,n){return this.$MercuryThreads34();}.bind(this));this.$MercuryThreads5.subscribe('update-threads',function(m,n){var o=(n.actions||[]).filter(function(p){return p.thread_id;});if(n.threads&&n.payload_source==c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO)n.threads.forEach(function(p){var q=p.thread_id;if(this.$MercuryThreads9.has(q)){this.$MercuryThreads9['delete'](q);if(p.unread_count)this.$MercuryThreads2.changeThreadReadStatus(p.thread_id,true);}}.bind(this));this.$MercuryThreads35(n.threads);this.$MercuryThreads16(o,n.from_client);n.threads&&n.threads.forEach(function(p){this.$MercuryThreads22(p.thread_id);}.bind(this));if(n.global_actions)n.global_actions.forEach(function(p){if(p.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryThreads32(p.folder);}.bind(this));if(this.$MercuryThreads7){this.$MercuryThreads7=false;i.emit('change');}}.bind(this));};k.prototype.$MercuryThreads35=function(m){if(!m||!m.length)return;var n={},o=[];m.forEach(function(p){var q=new (c('ImmutableObject'))(p);n[p.thread_id]=q;o.push(c('MercuryLoggingHelper').obfuscateThread(q));});o.length&&j.debug('threads_added',JSON.stringify({threads:o}));this.$MercuryThreads8.addResourcesAndExecute(n);};k.prototype.$MercuryThreads22=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.updatedThread(m);};k.prototype.$MercuryThreads20=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.deletedThread(m);};k.prototype.$MercuryThreads31=function(m,n,o){this.$MercuryThreads7=true;this.$MercuryThreads3.changedThreadReadState(m,n,o);};k.prototype.$MercuryThreads33=function(m){this.$MercuryThreads8.setResource(m,undefined);};k.prototype.$MercuryThreads34=function(){this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],(function a(b,c,d,e,f,g,h){var i=86400000,j=6*i,k={getFormatedTimestamp:function l(m){var n=m/1000;return k.getFormattedTimestampByBucket(n,this.getTimeBucket(m));},getAbsoluteTimestamp:function l(m){if(m==null){return null;}else{var n=k.getFormatedTimestamp(m);return n.absolute;}},getRelativeTimestamp:function l(m){var n=k.getFormatedTimestamp(m);return n.relative;},getFormattedTimestampByBucket:function l(m,n){switch(n){case c('MercuryTimePassed').TODAY:return {absolute:h._("Hoy"),relative:c('formatDate')(m,'g:ia')};case c('MercuryTimePassed').WEEK_AGO:return {absolute:c('formatDate')(m,'l'),relative:c('formatDate')(m,'D')};case c('MercuryTimePassed').CURRENT_YEAR:return {absolute:c('formatDate')(m,'F j'),relative:c('formatDate')(m,'M j')};default:return {absolute:c('formatDate')(m,'F j, Y'),relative:c('formatDate')(m,'n/j/y')};}},getTimeBucket:function l(m){var n=new Date(m),o=new Date(),p=new Date(o.getFullYear(),o.getMonth(),o.getDate());if(p<n){return c('MercuryTimePassed').TODAY;}else if(p-j<n){return c('MercuryTimePassed').WEEK_AGO;}else if(p.getFullYear()===n.getFullYear()){return c('MercuryTimePassed').CURRENT_YEAR;}else return c('MercuryTimePassed').OTHER_YEAR;},getPreciseTimestamp:function l(m){return c('formatDate')(new Date(m),k.getPreciseFormat(m));},getPreciseFormat:function l(m){var n=k.getTimeBucket(m);switch(n){case c('MercuryTimePassed').TODAY:return 'g:ia';case c('MercuryTimePassed').WEEK_AGO:return 'l g:ia';case c('MercuryTimePassed').CURRENT_YEAR:return 'F jS, g:ia';case c('MercuryTimePassed').OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=k;}),null);
__d('MercuryMessageObject',['fbt','BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercuryTimestamp','MercurySendMessageFields','formatDate'],(function a(b,c,d,e,f,g,h){i.getForFBID=function(n){'use strict';return m.getForFBID(n);};i.get=function(){'use strict';return m.get();};function i(n){'use strict';this.$MercuryMessageObject1=n;this.$MercuryMessageObject2=c('MercuryThreads').getForFBID(n);}i.prototype.constructUserGeneratedMessageObject=function(n,o,p,q,r){'use strict';var s=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,o,p);if(typeof n=='string')n=n.replace(/^\s+/,'').replace(/\s+$/,'');s.body=n;s.has_attachment=false;s.html_body=false;s.attachments=[];s.specific_to_list=q||[];s.creator_info=r;return s;};i.prototype.constructStickerMessageObject=function(n,o,p){'use strict';var q=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,o,p);q.has_attachment=true;q.html_body=false;q.attachments=[];q.sticker_id=n;q.specific_to_list=[];return q;};i.prototype.constructAttachmentMessageObject=function(n,o){'use strict';var p=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);p.attachments=[];p.specific_to_list=[];return p;};i.prototype.constructLogMessageObject=function(n,o,p,q){'use strict';var r=j(this.$MercuryMessageObject1,c('MercuryActionType').LOG_MESSAGE,n,o);r.log_message_type=p;r.log_message_data=q;if(q&&q.untypedData&&q.untypedData.ttl)r.ephemeral_ttl_mode=q.untypedData.ttl;return r;};i.prototype.constructCTAConfirmationMessageObject=function(n,o,p,q){'use strict';var r=this.constructUserGeneratedMessageObject(n,o,p,null,null),s={};if(q){s={quick_replies:q,ignore_for_webhook:false};}else s={ignore_for_webhook:true};r.platform_xmd=JSON.stringify(s);return r;};i.prototype.normalizeNewMessage=function(n){'use strict';if(n.status===undefined)n.status=c('MercuryActionStatus').UNSENT;n.timestamp_absolute=h._("Hoy").toString();n.offline_threading_id=n.offline_threading_id||c('MercuryLocalIDs').generateOfflineThreadingID(n.timestamp);if(!n.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','invalid_otid_generated');n.message_id=n.message_id||n.offline_threading_id;var o=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryMessageObject1);n.specific_to_list=n.specific_to_list||[];if(n.specific_to_list.length&&n.specific_to_list.indexOf(o)===-1)n.specific_to_list.push(o);if(!n.thread_id){n.thread_id='root:'+n.offline_threading_id;}else{var p=this.$MercuryMessageObject2.getThreadMetaNow(n.thread_id);if(p&&p.ephemeral_ttl_mode!==null&&n.ephemeral_ttl_mode===undefined)n.ephemeral_ttl_mode=p.ephemeral_ttl_mode;}if(n.specific_to_list.length==1){n.thread_id='user:'+this.$MercuryMessageObject1;}else if(n.specific_to_list.length==2){var q=n.specific_to_list[0]==o?n.specific_to_list[1]:n.specific_to_list[0];n.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(q);}if(!n.specific_to_list.length){var r=c('MercuryIDs').tokenize(n.thread_id),s=r.type,t=r.value;if(s=='user')n.specific_to_list=['fbid:'+t,o];}if(!n[c('MercurySendMessageFields').MANUAL_RETRY_CNT])n[c('MercurySendMessageFields').MANUAL_RETRY_CNT]=0;};i.prototype.normalizeResendMessage=function(n){'use strict';n.status=c('MercuryActionStatus').RESENDING;n.timestamp=Date.now();n[c('MercurySendMessageFields').MANUAL_RETRY_CNT]+=1;};i.prototype.normalizeAddAttachmentPlaceholder=function(n,o,p){'use strict';if(p.preview_attachments.length>0){n.has_attachment=true;n.preview_attachments=p.preview_attachments;}n.client_state=c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER;n.status=c('MercuryActionStatus').RESENDING;n.upload_id=o;};function j(n,o,p,q){var r=l(p)?[c('MercuryMessageSourceTags').CHAT]:[],s=Date.now(),t=c('formatDate')(new Date(s),'g:ia'),u=k(s),v={action_type:o,thread_id:q,author:c('MercuryIDs').getParticipantIDFromUserID(n),author_email:null,timestamp:s,timestamp_absolute:u,timestamp_relative:t,timestamp_time_passed:c('MercuryTimePassed').TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:p,source_tags:r};return v;}function k(n){try{return new Date(n).toLocaleDateString();}catch(o){var p=c('MercuryTimestamp').getFormatedTimestamp(n);return p.absolute;}}function l(n){switch(n){case c('MercurySourceType').CHAT_WEB:case c('MercurySourceType').CHAT_JABBER:case c('MercurySourceType').CHAT_IPHONE:case c('MercurySourceType').CHAT_MEEBO:case c('MercurySourceType').CHAT_ORCA:case c('MercurySourceType').CHAT_TEST:case c('MercurySourceType').CHAT:return true;default:return false;}}var m=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],(function a(b,c,d,e,f,g){'use strict';function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c('MercuryMessageObject').getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryMessageActions1);}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id);};h.prototype.resend=function(i,j){var k=babelHelpers['extends']({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j);};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype['delete']=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c('MercuryActionType').DELETE_MESSAGES,k||c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES));};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c('MercuryActionType').UNWRAP_MESSAGE},c('MercuryPayloadSource').CLIENT_UNWRAP_MESSAGE));};h.prototype.__constructClientSingleMessagePayload=function(i,j){return {actions:[i],from_client:true,payload_source:j};};h.prototype.$MercuryMessageActions4=function(i,j){return {actions:[i],from_client:false,payload_source:j};};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return {actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l};};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],(function a(b,c,d,e,f,g){'use strict';var h='fbid:'+c('CurrentUser').getID(),i={getID:function j(){return h;},isViewer:function j(k){c('MercuryAssert').isParticipantID(k);return k===h;}};f.exports=i;}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingGroupSetJoinableController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_joinable_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','URI','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupSetApprovalController','XMessagingGroupSetJoinableController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setJoinableMode=function(n,o){var p=c('XMessagingGroupSetJoinableController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerSharedMediaActions',['MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i='MessengerSharedMedia',j={Types:h,Namespace:i,currentLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.CURRENT_LOADED,namespace:i,data:l});},deletePhotos:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m});},loadCurrent:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m});},loadMorePrevious:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n});},loadMoreLatest:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n});},previousLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l});},latestLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.LATEST_LOADED,namespace:i,data:l});}};f.exports=j;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=(u.is_forward||u.thread_id)&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=u.reaction&&v==c('MercuryActionType').REACTION_UPDATE,z=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,aa=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;j.debug('fetch_missing_messages',JSON.stringify({threadID:p,offset:q,limit:r,timestamp:fa,missingIndices:y,messageCount:aa,localMessageCount:ba}));this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(w.is_forward||r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages30(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y&&!y.is_forward){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages31(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages33(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages34(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages35(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages36(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages34(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}this.$MercuryMessages8&&j.debug('handle_updates',JSON.stringify({localMessageCounts:this.$MercuryMessages11}));};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages37(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages37=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages34(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages33=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages31=function(p,q){var r=this.$MercuryMessages38(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages38(p,q);this.$MercuryMessages37(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages38=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages35=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages34=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages34(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.map(function(r){return this.$MercuryMessages17(r);}.bind(this));return q.reverse();};l.prototype.$MercuryMessages36=function(p,q){var r=q.filter(function(s){return (m(this.$MercuryMessages17(s)));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get();function k(l,m){c('MercuryAssert').isThreadID(l);j.getThreadMeta(l,function(n){i.getThreadMessagesRange(l,0,1,function(o){var p=o.length&&o[o.length-1];if(p.log_message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST){m(h._("New contact added"));}else if(p&&p.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(p.author,function(q){var r=q.short_name;if(n.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(n.custom_nickname[s])r=n.custom_nickname[s];}if(n.name){m(h._("{senderName} ha enviado un mensaje a {groupName}",[h.param('senderName',r),h.param('groupName',n.name)]));}else if(c('MercuryIDs').isGroupChat(l)){m(h._("{name} messaged your group",[h.param('name',r)]));}else m(h._("{name} te ha enviado un mensaje",[h.param('name',r)]));});}else m(h._("Nuevo mensaje"));});});}f.exports={renderDocumentTitle:k};}),null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryDispatcher','MercuryPayloadSource','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c('MercuryDispatcher').getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe('update-messages',this.$MercuryTimestampTracker4.bind(this));}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source===c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp;}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('ChatTitleBarBlinker',['ChatActivity','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c('PresenceState').doSync();}}var p={blink:function u(v,w){if(!k&&l<w)c('MercuryNotificationRenderer').renderDocumentTitle(v,function(x){if(!k)k=c('DocumentTitle').blink(x);});},stopBlinking:function u(){o();},blinkingElsewhere:function u(){m=true;}};function q(u){var v=c('PresenceState').verifyNumber(u.sb2);if(!v||v<=l)return null;return v;}function r(u){var v=u&&q(u);if(v){l=v;j.debug('load',l);n();m=false;}}function s(u){var v=q(u);if(!v){j.debug('store',l);u.sb2=l;m=false;}return u;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x);});c('ChatActivity').subscribe('activity',function(){return o();});var t=c('PresenceState').getInitial();if(t)l=q(t)||0;f.exports=p;}),null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryBlockedParticipants1=j;this.$MercuryBlockedParticipants2=new (c('Set'))();this.$MercuryBlockedParticipants3=c('MercuryDispatcher').getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(k,l){if(l.message_blocked_ids)this.$MercuryBlockedParticipants2=new (c('Set'))(l.message_blocked_ids);var m=l.participants||[];for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.is_messenger_blocked===true)this.$MercuryBlockedParticipants4(r.fbid);if(r.is_messenger_blocked===false)this.$MercuryBlockedParticipants5(r.fbid);}}.bind(this));}h.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};h.prototype.setIDs=function(j){this.$MercuryBlockedParticipants2=j;};h.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};h.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};h.prototype.$MercuryBlockedParticipants4=function(j){this.$MercuryBlockedParticipants2.add(c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.$MercuryBlockedParticipants5=function(j){this.$MercuryBlockedParticipants2['delete'](c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.isMessageBlocked=function(j){if(!j.is_canonical)return false;var k=j.participants.filter(function(l){return l!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this));return !k.every(function(l){return !this.$MercuryBlockedParticipants2.has(l);}.bind(this));};h.prototype.isPresentInGroupThread=function(j){if(!j.is_canonical&&this.$MercuryBlockedParticipants7(j).length>0)return true;return false;};h.prototype.inGroupThread=function(j){if(j.is_canonical)return [];return this.$MercuryBlockedParticipants7(j);};h.prototype.$MercuryBlockedParticipants7=function(j){if(!j.participants)return [];var k=j.participants.filter(function(m){return m!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this)),l=k.filter(function(m){return this.$MercuryBlockedParticipants2.has(m)!==false;}.bind(this));return l;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],(function a(b,c,d,e,f,g){var h={messageMentionsViewer:function i(j,k){c('ShortProfiles').get(c('CurrentUser').getID(),function(l){k(new RegExp('@'+l.firstName,'i').test(j.body));});}};f.exports=h;}),null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','Event','Map','MercuryBlockedParticipants','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryBlockedParticipants').get(),i=c('MercuryThreads').get(),j=3,k=600000,l=new (c('Map'))(),m=0;function n(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function o(){l=new (c('Map'))();}function p(r){if(c('ChatOptions').getSetting('sound')&&!n())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],r,false);}var q=Object.assign({init:function r(){c('Event').listen(window,'focus',function(){o();clearInterval(m);});c('Event').listen(window,'blur',function(){m=setInterval(o,k);});},messageReceived:function r(s){if(s.author&&c('MercuryViewer').isViewer(s.author)||!s.is_unread||s.folder!=c('MessagingTag').INBOX&&s.folder!=c('MessagingTag').ARCHIVED)return;var t=s.thread_id,u=c('ChatActivity').isActive();if(u){var v=false;q.inform('before-alert',{threadID:t,cancelAlert:function w(){v=true;}});}i.getThreadMeta(t,function(w){var x=c('MercuryThreadInfo').isMuted(w);c('MercuryGroupThreadMentions').messageMentionsViewer(s,function(y){if(x&&(!c('MercuryConfig').GroupChatMentionsGK||!y))return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u){!v&&p(z);}else{c('ChatTitleBarBlinker').blink(t,z);var aa=l.get(t)||0;if(aa<j){l.set(t,aa+1);p(z);}}c('ChatTitleBarBlinker').blinkingElsewhere();});});}},c('ArbiterMixin'));f.exports=q;}),null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],(function a(b,c,d,e,f,g){var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function n(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function n(){return j;},showsTabUnreadUI:function n(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;}),null);
__d('MercuryFilters',['MessagingTag','arrayContains'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').UNREAD],i={ALL:'all',NONPRIORITY:'non-priority',UNREAD:c('MessagingTag').UNREAD,getSupportedFilters:function j(){return h.concat();},isSupportedFilter:function j(k){return c('arrayContains')(h,k);}};f.exports=i;}),null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],(function a(b,c,d,e,f,g){'use strict';var h={preprocess:function j(k){var l=k.activeThreadID;if(l){var m=c('MercuryIDs').getUserIDFromThreadID(l),n=m&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(m));if(n&&n.type!==c('MercuryParticipantTypes').EVENT){k.threadKey=n.vanity||m;}else if(m&&!n){var o=c('MercuryIDs').getParticipantIDFromUserID(m);k.threadKey=c('MercuryVanityIDMap').hasID(o)?c('MercuryVanityIDMap').getVanity(o):m;}else{var p=c('MercuryThreadIDMap').get(),q=p.getServerIDFromClientIDNow(l);k.threadKey=q||c('MercuryIDs').tokenize(l).value;}}delete k.activeThreadID;return k;},postprocess:function j(k){var l=c('MercuryThreadIDMap').get(),m=c('MercuryThreads').get(),n=i(k.threadKey),o=void 0;o=c('MercuryIDs').isValid(n)?n:l.getClientIDFromServerIDNow(n);if(!o){var p=c('MercuryParticipants').getIDFromVanityOrFBID(n),q=p&&m.getCanonicalThreadToParticipant(p,null,c('MercuryAPIArgsSource').MESSENGER);if(q)o=q.thread_id;}if(o){k.activeThreadID=o;k.serverThreadID=l.getServerIDFromClientIDNow(o);}delete k.threadKey;return k;},supportInboxPostprocess:function j(k){if(k.threadKey)k.activeThreadID=c('MercuryIDs').getThreadIDFromSupportInboxItemID(k.threadKey);delete k.threadKey;return k;}};function i(j){if(!j)return null;return j.startsWith(c('MessengerURIConstants').GROUP_PREFIX)?j.substr(c('MessengerURIConstants').GROUP_PREFIX.length):j;}f.exports=h;}),null);
__d('MessengerURISerializer',['CurrentEnvironment','MercuryFilters','MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],(function a(b,c,d,e,f,g){'use strict';var h='/?$',i=function m(n,o){n.setPath(c('CurrentEnvironment').facebookdotcom?c('MessengerURIConstants').FACEBOOK_PREFIX+o:o);},j=function m(n,o){var p=n.getPath();if(c('CurrentEnvironment').facebookdotcom&&!p.startsWith(c('MessengerURIConstants').FACEBOOK_PREFIX))o=c('MessengerURIConstants').FACEBOOK_PREFIX+o;n.setPath(n.getPath()+o);},k={serialize:function m(n){var o=new (c('URI'))(c('WWWBase').uri);n=c('MessengerStateProcessor').preprocess(n);switch(n.masterView){case c('MessengerView').MASTER.GROUPS:i(o,c('MessengerURIConstants').GROUPS_PATH);break;case c('MessengerView').MASTER.PEOPLE:i(o,c('MessengerURIConstants').PEOPLE_PATH);break;case c('MessengerView').MASTER.SUPPORT:i(o,c('MessengerURIConstants').SUPPORT_PATH);break;}switch(n.folder){case c('MessagingTag').OTHER:i(o,c('MessengerURIConstants').FILTERED_REQUESTS_PATH);break;case c('MessagingTag').ACTION_ARCHIVED:i(o,c('MessengerURIConstants').ARCHIVED_PATH);break;case c('MessagingTag').PENDING:i(o,c('MessengerURIConstants').MESSAGE_REQUESTS_PATH);break;}if(n.detailView===c('MessengerView').DETAIL.COMPOSE){j(o,c('MessengerURIConstants').COMPOSE_SUBPATH);}else if(n.threadKey){j(o,c('MessengerURIConstants').THREAD_PREFIX+n.threadKey);}else j(o,'');if(n.extraQueryParms)o.addQueryData(n.extraQueryParams);if(c('MercuryFilters').isSupportedFilter(n.filter))o.addQueryData({filter:n.filter});if(n.query!=null){var p;o.addQueryData((p={},p[n.masterView===c('MessengerView').MASTER.SEARCH?'qa':'q']=n.query,p));}if(n.mid)o.addQueryData({mid:n.mid});return o;},deserialize:function m(n){var o={},p=n.getPath();if(c('CurrentEnvironment').facebookdotcom&&!p.startsWith(c('MessengerURIConstants').FACEBOOK_PREFIX))o.notMessenger=true;var q=p.replace(c('MessengerURIConstants').FACEBOOK_PREFIX,''),r=n.getQueryData(),s=r.filter,t=r.mid,u=r.q,v=r.qa,w=babelHelpers.objectWithoutProperties(r,['filter','mid','q','qa']);if(q.match('^'+c('MessengerURIConstants').GROUPS_PATH)){o.masterView=c('MessengerView').MASTER.GROUPS;}else if(q.match('^'+c('MessengerURIConstants').PEOPLE_PATH)){o.masterView=c('MessengerView').MASTER.PEOPLE;}else if(q.match('^'+c('MessengerURIConstants').SUPPORT_PATH)){o.masterView=c('MessengerView').MASTER.SUPPORT;}else if(v){o.masterView=c('MessengerView').MASTER.SEARCH;}else o.masterView=c('MessengerView').MASTER.RECENT;if(q.match('^'+c('MessengerURIConstants').FILTERED_REQUESTS_PATH)){o.folder=c('MessagingTag').OTHER;}else if(q.match('^'+c('MessengerURIConstants').ARCHIVED_PATH)){o.folder=c('MessagingTag').ACTION_ARCHIVED;}else if(q.match('^'+c('MessengerURIConstants').MESSAGE_REQUESTS_PATH)){o.folder=c('MessagingTag').PENDING;}else o.folder=c('MessagingTag').INBOX;if(q.match(c('MessengerURIConstants').COMPOSE_SUBPATH+h)){o.detailView=c('MessengerView').DETAIL.COMPOSE;}else{var x=l(q);if(x){o.threadKey=x;o.detailView=c('MessengerView').DETAIL.THREAD;}}if(c('MercuryFilters').isSupportedFilter(s)){o.filter=s;}else o.filter=c('MercuryFilters').ALL;o.mid=t;o.query=v||u;o.extraQueryParams=w;if(o.masterView===c('MessengerView').MASTER.SUPPORT)return c('MessengerStateProcessor').supportInboxPostprocess(o);return c('MessengerStateProcessor').postprocess(o);}};function l(m){var n=m.match(c('MessengerURIConstants').THREAD_PREFIX+'([^/]+)'+h);return n&&n[1];}f.exports=k;}),null);
__d('MessengerActions',['invariant','MercuryIDs','MessengerDispatcher','MessengerURISerializer','MercuryTypeaheadConstants','MessengerView','URI','goURI','keyMirror'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('keyMirror')({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null,UPDATE_MDOT_ME:null}),j={Types:i,changeDetailView:function m(n){l(function(o){if(o.detailView!==n)return {detailView:n};});},changeMasterView:function m(n){l(function(o){if(o.masterView!==n){var p={masterView:n};if(o.masterView===c('MessengerView').MASTER.SEARCH)p.query=undefined;return p;}});},selectThread:function m(n,o){if(o===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){!!n||h(0);var p=c('MercuryIDs').getUserIDFromThreadID(n);!!p||h(0);var q=new (c('URI'))(),r=q.getQualifiedURI().getSubdomain();q.setDomain('facebook.com').setSubdomain(r).setPath('/'+p).setProtocol('https');window.open(q,'_blank');return;}l(function(s){if(s.activeThreadID!==n)return {activeThreadID:n,detailView:c('MessengerView').DETAIL.THREAD,mid:null};});},changeState:function m(n){c('MessengerDispatcher').dispatch({type:i.REPLACE_STATE,nextState:n});},showDialog:function m(n,o){c('MessengerDispatcher').dispatch({type:j.Types.SHOW_DIALOG,dialogClass:n,dialogProps:o});},changeMDotMeReferral:function m(){var n=arguments.length<=0||arguments[0]===undefined?null:arguments[0],o=arguments.length<=1||arguments[1]===undefined?null:arguments[1];c('MessengerDispatcher').dispatch({type:j.Types.UPDATE_MDOT_ME,refCode:n,refThreadID:o});},hideDialog:function m(n){c('MessengerDispatcher').dispatch({type:j.Types.HIDE_DIALOG,dialogClass:n});},changeFolder:function m(n){l(function(o){if(o.folder!==n)return {folder:n};});},changeFilter:function m(n){l(function(o){if(o.filter!==n)return {filter:n};});},changeQuery:function m(n){l(function(o){if(o.query!==n)return {query:n};});},changeQueryAll:function m(n){var o=!!n;l(function(p){if(p.queryAll!==n)return {query:n,masterView:c('MessengerView').MASTER.SEARCH};});},changeMid:function m(n){l(function(o){if(o.mid!==n)return {mid:n};});}};function k(m,n){return m.detailView==null;}function l(m){var n=c('MessengerURISerializer').deserialize(new (c('URI'))(window.location.href)),o=m(n),p=k(n,o);if(o)c('goURI')(c('MessengerURISerializer').serialize(Object.assign(n,o)),false,p);}f.exports=j;}),null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirrorRecursive')({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null},PROMOTION_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},TRANSACTION_INVOICE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},BOT_REVIEW_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},BOTS_MENU:{SHOW:null,HIDE:null,LOADED:null,VISIBILITY_LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=h;}),null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}j.prototype.__onDispatch=function(k){var l=k.type;switch(l){case c('MNCommerceActionTypes').DIALOG.SHOW:this.$MNCommerceDialogStateStore1=k.dialogContainer;this.$MNCommerceDialogStateStore2=k.state;this.__emitChange();break;case c('MNCommerceActionTypes').DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};j.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};j.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new j();}),null);
__d('HotLikeSound',['MercurySoundsConfig','SoundPlayer','StickerConstants'],(function a(b,c,d,e,f,g){'use strict';var h=[c('MercurySoundsConfig').hot_like_grow_mp3_url,c('MercurySoundsConfig').hot_like_grow_ogg_url],i=[c('MercurySoundsConfig').hot_like_pop_mp3_url,c('MercurySoundsConfig').hot_like_pop_ogg_url],j=[c('MercurySoundsConfig').hot_like_outgoing_small_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_small_ogg_url],k=[c('MercurySoundsConfig').hot_like_outgoing_medium_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_medium_ogg_url],l=[c('MercurySoundsConfig').hot_like_outgoing_large_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_large_ogg_url],m=function o(){return false;},n={setCheckSoundEnabledFunc:function o(p){m=p;},start:function o(){this._play(h);},stop:function o(){c('SoundPlayer').stop(h);},pop:function o(){this.stop();this._play(i);},snap:function o(p){this.stop();if(p===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function o(p){if(m())c('SoundPlayer').play(p);}};f.exports=n;}),null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('MercuryActionStatus').SUCCESS;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(o){return l.getForFBID(o);};k.get=function(){return l.get();};function k(o){i.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=o;this.$MercuryRoger4=c('MercuryDispatcher').getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=c('MercuryThreads').getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(p,q){for(var r in q){var s=this.$MercuryRoger1[r]||c('immutable').OrderedMap();s=s.withMutations(function(t){for(var u in q[r]){var v=this.$MercuryRoger5.getThreadMetaNow(r);if(v&&v.participants)if(v.participants.indexOf(u)==-1){this.$MercuryRoger2.push(n(this.$MercuryRoger1));continue;}var w=t.get(u),x=q[r][u];if(!w||x.watermark>w.watermark)t.set(u,x);}}.bind(this));this.$MercuryRoger1[r]=s.sort(function(t,u){return t.watermark-u.watermark;});}q&&this.inform('change',q);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(p,q){var r={};for(var s in this.$MercuryRoger1)if(this.$MercuryRoger1.hasOwnProperty(s))r[s]=this.$MercuryRoger1[s].toObject();q.read_receipts={valid_receipts:r,bad_receipts:this.$MercuryRoger2};}.bind(this));}k.prototype.getSeenBy=function(o,p){if(!o)return [];var q=[],r=this.$MercuryRoger1[o.thread_id];if(!r)return q;r.forEach(function(s,t){if(m(o,s.watermark,t,p))q.push(t);});return q;};k.prototype.wasSeenByAll=function(o){if(!o)return false;var p=this.$MercuryRoger1[o.thread_id];if(!p)return false;return p.every(function(q,r){return m(o,q.watermark,r);});};k.prototype.getSeenTimestamps=function(o){var p=this.$MercuryRoger1[o];if(!p){p=c('immutable').OrderedMap();this.$MercuryRoger1[o]=p;}return p;};k.prototype.getSeenTimestamp=function(o,p){var q=this.$MercuryRoger1[o];return q?q.get(p):null;};k.prototype.$MercuryRoger6=function(){this.$MercuryRoger1={};this.$MercuryRoger2=[];};var l=new (c('MercurySingletonProvider'))(k);function m(o,p,q,r){return !!(p>=o.timestamp&&(o.status===undefined||o.status===j)&&(!r||q!=o.author));}function n(o){return c('mapObject')(o,function(p){return p.toJS();});}f.exports=k;}),null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','MercuryRoger','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','mixin','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){var h,i,j=c('MercuryConfig')['roger.seen_delay'];h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o);}.bind(this));}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c('MercuryRoger').getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe('change',function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p);}.bind(this));this.$MercuryDelayedRoger3=c('MercuryThreadInformer').getForFBID(m);this.$MercuryDelayedRoger6=c('MercuryMessages').getForFBID(m);this.$MercuryDelayedRoger7=c('MercuryThreads').getForFBID(m);this.$MercuryDelayedRoger3.subscribe('messages-received',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-reordered',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-updated',this.$MercuryDelayedRoger9);}k.prototype.getSeenBy=function(m,n){'use strict';if(this.$MercuryDelayedRoger5[m])return [];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n);};k.prototype.wasSeenByAll=function(m){'use strict';if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m));};k.prototype.$MercuryDelayedRoger10=function(m){'use strict';if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp};}return this.$MercuryDelayedRoger4[m];};k.prototype.$MercuryDelayedRoger11=function(m){'use strict';var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c('MercuryActionStatus').SUCCESS)q-=c('LiveTimer').getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m];}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c('setTimeoutAcrossTransitions')(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m);}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true;}.bind(this));return n;};k.prototype.$MercuryDelayedRoger8=function(m){'use strict';var n={};n[m]=true;this.$MercuryDelayedRoger12(n);};k.prototype.$MercuryDelayedRoger12=function(m){'use strict';this.inform('state-changed',m);this.inform('change');};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryFolders',['MercuryFoldersConfig','MessagingTag'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function j(){return h.filter(function(k){if(k===c('MessagingTag').PENDING){return !c('MercuryFoldersConfig').hide_message_filtered;}else if(k===c('MessagingTag').OTHER)return !c('MercuryFoldersConfig').hide_message_requests;return true;}).concat();},getFromMeta:function j(k){var l=k.folder;if(k.is_archived)l=c('MessagingTag').ACTION_ARCHIVED;return l;}};f.exports=i;}),null);
__d('MercuryUnreadState',['invariant','MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i=(c('MercuryFolders').getSupportedFolders()||[]).filter(function(p){return p!==c('MessagingTag').ACTION_ARCHIVED;}),j='unread_thread_hash',k='unseen_thread_list',l=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,m=c('LogHistory').getInstance('mercury_unread_state');n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercuryUnreadState1=p;this.$MercuryUnreadState2=c('MercuryServerRequests').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState3=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState4=c('MercuryThreadInformer').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState5=c('MercuryThreads').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState6=c('MercuryDispatcher').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState7={};this.$MercuryUnreadState8={};this.$MercuryUnreadState9={};this.$MercuryUnreadState10={};this.$MercuryUnreadState11={};i.forEach(function(q){this.$MercuryUnreadState9[q]=0;this.$MercuryUnreadState10[q]=false;this.$MercuryUnreadState11[q]=new (c('KeyedCallbackManager'))();}.bind(this));this.$MercuryUnreadState6.subscribe('update-unread',this.$MercuryUnreadState12.bind(this));this.$MercuryUnreadState6.subscribe('update-thread-ids',function(q,r){this.$MercuryUnreadState13(r);}.bind(this));}n.prototype.getUnreadCount=function(p){if(this.exceedsMaxCount(p)){m.error('unguarded_unread_count_fetch','{}');return 0;}return this.$MercuryUnreadState14(p);};n.prototype.exceedsMaxCount=function(p){return this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>l;};n.prototype.markFolderAsRead=function(p){if(this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>0)this.$MercuryUnreadState2.markFolderAsRead(p);};n.prototype.getIsThreadUnread=function(p,q){var r=q||c('MessagingTag').INBOX,s=this.$MercuryUnreadState15(r);return !!(s&&s[p]);};n.prototype.$MercuryUnreadState12=function(p,q){this.$MercuryUnreadState16(q);var r=q.global_actions||[];for(var s=0;s<r.length;s++){var t=r[s];if(t.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryUnreadState17(t.folder,t.timestamp);}};n.prototype.$MercuryUnreadState18=function(p,q){this.$MercuryUnreadState11[p].setResource(j,q);this.$MercuryUnreadState11[p].setResource(k,Object.keys(q));};n.prototype.$MercuryUnreadState19=function(p,q){var r=this.$MercuryUnreadState11[p].executeOrEnqueue(j,q),s=this.$MercuryUnreadState11[p].getUnavailableResources(r);if(s.length)this.$MercuryUnreadState2.fetchUnreadThreadIDs(p);};n.prototype.$MercuryUnreadState15=function(p){return this.$MercuryUnreadState11[p].getResource(j);};n.prototype.$MercuryUnreadState14=function(p){var q=this.$MercuryUnreadState11[p].getResource(k);if(q){return q.length;}else return this.$MercuryUnreadState9[p];};n.prototype.$MercuryUnreadState16=function(p){var q=void 0;(p.unread_thread_fbids||[]).forEach(function(r){q=r.folder;if(!this.$MercuryUnreadState20(q))return;var s=r.thread_fbids||[];s=s.concat(r.other_user_fbids||[]);var t=this.$MercuryUnreadState21(s);this.$MercuryUnreadState18(q,c('createObjectFrom')(t,true));if(t.length>l)this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState4.updatedUnreadState();}.bind(this));(p.message_counts||[]).forEach(function(r){if(r.unread_count===undefined)return;q=r.folder;if(r.unread_count>l){this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}else{this.$MercuryUnreadState9[q]=r.unread_count;if(this.$MercuryUnreadState9[q]===0)this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));(p.actions||[]).forEach(function(r){if(r.is_forward)return;var s=c('MercuryActionType'),t=r.other_user_fbid?r.other_user_fbid:r.thread_fbid,u=r.thread_id?r.thread_id:t;if(r.action_type==s.DELETE_THREAD){i.forEach(function(w){this.$MercuryUnreadState22(w,u);}.bind(this));}else if(r.action_type==s.CHANGE_ARCHIVED_STATUS||r.action_type==s.CHANGE_FOLDER){var v=this.$MercuryUnreadState5.getThreadMetaNow(r.thread_id);!!v||h(0);q=c('MercuryFolders').getFromMeta(v);if(this.$MercuryUnreadState20(q)&&v.unread_count>0)this.$MercuryUnreadState23(q,u);i.forEach(function(w){if(w!=q)this.$MercuryUnreadState22(w,u);}.bind(this));}else{q=this.$MercuryUnreadState24(r);if(!this.$MercuryUnreadState20(q))return;if(r.action_type==s.CHANGE_READ_STATUS){if(r.mark_as_read){this.$MercuryUnreadState22(q,u,r.timestamp);}else this.$MercuryUnreadState23(q,u,r.timestamp);}else if(r.action_type==s.USER_GENERATED_MESSAGE||r.action_type==s.LOG_MESSAGE)if(r.is_unread)this.$MercuryUnreadState23(q,u,r.timestamp);}}.bind(this));};n.prototype.$MercuryUnreadState23=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){var t=this.$MercuryUnreadState7[p]||0,u=this.$MercuryUnreadState8[q]||0,v=r||Number.POSITIVE_INFINITY;if(v>=t&&v>=u&&!s[q]){s[q]=r||0;this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState22=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){if(r){var t=this.$MercuryUnreadState8[q];if(!t||t<r)this.$MercuryUnreadState8[q]=r;}var u=s[q];if(r&&typeof u=='number'&&r<u)return;if(q in s){delete s[q];this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState17=function(p,q){this.$MercuryUnreadState10[p]=false;this.$MercuryUnreadState18(p,{});this.$MercuryUnreadState7[p]=Math.max(this.$MercuryUnreadState7[p]||0,q||0);this.$MercuryUnreadState4.updatedUnreadState();};n.prototype.$MercuryUnreadState21=function(p){return p.map(this.$MercuryUnreadState3.convertThreadIDIfAvailable,this.$MercuryUnreadState3);};n.prototype.$MercuryUnreadState13=function(p){i.forEach(function(q){var r=this.$MercuryUnreadState15(q);if(!r)return;for(var s in p){var t=p[s];if(r[s]){r[t]=r[s];delete r[s];}}this.$MercuryUnreadState18(q,r);}.bind(this));};n.prototype.$MercuryUnreadState24=function(p){var q=p.thread_id?this.$MercuryUnreadState5.getThreadMetaNow(p.thread_id):null;return q?c('MercuryFolders').getFromMeta(q):p.folder?p.folder:'';};n.prototype.$MercuryUnreadState20=function(p){return c('arrayContains')(i,p);};var o=new (c('MercurySingletonProvider'))(n);f.exports=n;}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y];if(z.is_forward)return 'continue';var aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){var ga=false;if(fa&&fa.last_read_timestamp)if(fa.last_read_timestamp>=z.timestamp)ga=true;if(!c('MercuryThreadInfo').isMuted(fa)&&!ga)t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercurySyncConstants',[],(function a(b,c,d,e,f,g){'use strict';var h={ARBITER_EVENT_INVALID_STATE:'SYNC:INVALID_STATE',ARBITER_EVENT_INVALID_STATE_RETRY:'SYNC:INVALID_STATE_RETRY',ARBITER_EVENT_INVALID_STATE_RECOVER:'SYNC:INVALID_STATE_RECOVER'};f.exports=h;}),null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','Map','P2PDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=void 0,k=void 0;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(){i.constructor.call(this);k=new (c('Map'))();j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}l.prototype.onEventDispatched=function(m){var n=m.data,o=m.type;switch(o){case c('P2PActionConstants').CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(n);this.emit('change');break;case c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(n);this.emit('change');break;}};l.prototype.getStateByThreadID=function(m){return k.get(m);};l.prototype.handleChatSendViewOpened=function(m){k.set(m.threadID,{amount:m.amount,groupSendRecipientUserID:m.groupSendRecipientUserID,groupSendReceiptDetails:m.groupSendReceiptDetails,groupThreadFBID:m.groupThreadFBID,onCompletion:m.onCompletion,openRequestTab:m.openRequestTab,memoText:m.memoText,platformData:m.platformData,referrer:m.referrer,paymentRequestID:m.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:m.sendMoneyNUXDismissed,useModal:m.useModal});};l.prototype.handleChatSendViewClosed=function(m){k.set(m.threadID,{amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',onCompletion:null,openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false});};l.prototype.isAnyChatSendViewOpen=function(){for(var m=k.values(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;if(q.sendMoneyDialogShown)return true;}return false;};f.exports=new l();}),null);
__d('isInFocusMode',['WorkFocusModeController'],(function a(b,c,d,e,f,g){var h=c('WorkFocusModeController').WorkFocusMode,i=function j(k){return !!(h&&h.currentViewerInFocusMode(k));};f.exports=i;}),null);
__d('PureStoreBasedStateMixin',['invariant','StoreBasedStateMixinHelper','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];return {getInitialState:function m(){return this.constructor.calculateState();},componentWillMount:function m(){this.constructor.calculateState||h(0);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new (c('StoreBasedStateMixinHelper'))(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=c('setImmediate')(n);}.bind(this));},componentWillUnmount:function m(){this._mixin.release();this._mixin=null;}};}.bind(this);f.exports=i;}),null);
__d('idx',[],(function a(b,c,d,e,f,g){'use strict';function h(n,o){try{return o(n);}catch(p){if(p instanceof TypeError)if(j(p)){return null;}else if(l(p))return undefined;throw p;}}var i=void 0;function j(n){var o=n.message;if(!i)i=m(null);return i.test(o);}var k=void 0;function l(n){var o=n.message;if(!k)k=m(undefined);return k.test(o);}var m=new Function('$object$','\n  try {\n    $object$.$property$;\n  } catch (error) {\n    return new RegExp(\n      error.message\n        .replace(/[-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \'\\\\$&\')\n        .replace(\'\\\\$object\\\\$\', \'.+\')\n        .replace(\'\\\\$property\\\\$\', \'.+\')\n    );\n  }\n  throw new Error(\'Expected property access on \' + $object$ + \' to throw.\');\n');f.exports=h;}),null);